"use strict";(self.webpackChunkwebsite_2=self.webpackChunkwebsite_2||[]).push([[995],{2591:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>d,default:()=>h,frontMatter:()=>a,metadata:()=>l,toc:()=>c});const l=JSON.parse('{"id":"documents/event_queue","title":"\u4e8b\u4ef6\u4f47\u5217\uff08EventQueue\uff09","description":"Skalds \u7cfb\u7d71\u4e2d\u7684 EventQueue \u662f\u5be6\u73fe\u6a21\u7d44\u9593\u9b06\u8026\u5408\u3001\u9ad8\u6548\u80fd\u901a\u8a0a\u7684\u95dc\u9375\u5143\u4ef6\u3002\u5b83\u57fa\u65bc Kafka 3.9.0+\uff0c\u63a1\u7528\u767c\u4f48/\u8a02\u95b1\uff08Pub/Sub\uff09\u6a5f\u5236\uff0c\u8ca0\u8cac System Controller\u3001Task Generator\uff08Skald\uff09\u3001Task Worker \u4e4b\u9593\u7684\u4e8b\u4ef6\u50b3\u905e\u8207\u72c0\u614b\u540c\u6b65\u3002EventQueue \u5177\u5099\u9ad8\u541e\u5410\u91cf\u3001\u53ef\u9760\u6027\u8207\u5f48\u6027\u64f4\u5c55\u80fd\u529b\uff0c\u662f\u5206\u6563\u5f0f\u4efb\u52d9\u8abf\u5ea6\u7684\u6838\u5fc3\u901a\u8a0a\u6a1e\u7d10\u3002","source":"@site/docs/documents/event_queue.md","sourceDirName":"documents","slug":"/documents/event_queue","permalink":"/Skalds/docs/documents/event_queue","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5,"sidebar_label":"EventQueue"},"sidebar":"documentsSidebar","previous":{"title":"CacheMemory","permalink":"/Skalds/docs/documents/cache_memory"},"next":{"title":"Skald","permalink":"/Skalds/docs/documents/skald"}}');var r=s(5813),i=s(9863);const a={sidebar_position:5,sidebar_label:"EventQueue"},d="\u4e8b\u4ef6\u4f47\u5217\uff08EventQueue\uff09",t={},c=[{value:"\u8a2d\u8a08\u7406\u5ff5",id:"\u8a2d\u8a08\u7406\u5ff5",level:2},{value:"\u67b6\u69cb\u8207\u89d2\u8272",id:"\u67b6\u69cb\u8207\u89d2\u8272",level:2},{value:"\u4e8b\u4ef6\u683c\u5f0f\u8207\u8cc7\u6599\u7d50\u69cb",id:"\u4e8b\u4ef6\u683c\u5f0f\u8207\u8cc7\u6599\u7d50\u69cb",level:2},{value:"1. TaskEvent",id:"1-taskevent",level:3},{value:"\u7bc4\u4f8b payload",id:"\u7bc4\u4f8b-payload",level:4},{value:"2. UpdateTaskWorkerEvent",id:"2-updatetaskworkerevent",level:3},{value:"\u7bc4\u4f8b payload",id:"\u7bc4\u4f8b-payload-1",level:4},{value:"\u4e8b\u4ef6\u751f\u547d\u9031\u671f\u4e2d\u7684\u89d2\u8272",id:"\u4e8b\u4ef6\u751f\u547d\u9031\u671f\u4e2d\u7684\u89d2\u8272",level:2},{value:"1. \u4efb\u52d9\u5efa\u7acb",id:"1-\u4efb\u52d9\u5efa\u7acb",level:3},{value:"2. \u4efb\u52d9\u66f4\u65b0",id:"2-\u4efb\u52d9\u66f4\u65b0",level:3},{value:"3. \u4efb\u52d9\u53d6\u6d88",id:"3-\u4efb\u52d9\u53d6\u6d88",level:3},{value:"\u6280\u8853\u9078\u578b\u8207 Kafka \u67b6\u69cb",id:"\u6280\u8853\u9078\u578b\u8207-kafka-\u67b6\u69cb",level:2},{value:"\u4e8b\u4ef6\u4e3b\u984c\uff08Topic\uff09\u8a2d\u8a08",id:"\u4e8b\u4ef6\u4e3b\u984ctopic\u8a2d\u8a08",level:2},{value:"Kafka Proxy \u4ecb\u9762\u8aaa\u660e",id:"kafka-proxy-\u4ecb\u9762\u8aaa\u660e",level:2},{value:"\u5178\u578b\u7528\u6cd5",id:"\u5178\u578b\u7528\u6cd5",level:3},{value:"\u5178\u578b\u61c9\u7528\u5834\u666f",id:"\u5178\u578b\u61c9\u7528\u5834\u666f",level:2},{value:"\u6548\u80fd\u512a\u5316\u8207\u6ce8\u610f\u4e8b\u9805",id:"\u6548\u80fd\u512a\u5316\u8207\u6ce8\u610f\u4e8b\u9805",level:2},{value:"\u90e8\u7f72\u5efa\u8b70",id:"\u90e8\u7f72\u5efa\u8b70",level:2},{value:"\u53c3\u8003\u6587\u4ef6\u8207\u5ef6\u4f38\u95b1\u8b80",id:"\u53c3\u8003\u6587\u4ef6\u8207\u5ef6\u4f38\u95b1\u8b80",level:2}];function o(e){const n={a:"a",blockquote:"blockquote",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"\u4e8b\u4ef6\u4f47\u5217eventqueue",children:"\u4e8b\u4ef6\u4f47\u5217\uff08EventQueue\uff09"})}),"\n",(0,r.jsxs)(n.p,{children:["Skalds \u7cfb\u7d71\u4e2d\u7684 ",(0,r.jsx)(n.strong,{children:"EventQueue"})," \u662f\u5be6\u73fe\u6a21\u7d44\u9593\u9b06\u8026\u5408\u3001\u9ad8\u6548\u80fd\u901a\u8a0a\u7684\u95dc\u9375\u5143\u4ef6\u3002\u5b83\u57fa\u65bc ",(0,r.jsx)(n.strong,{children:"Kafka 3.9.0+"}),"\uff0c\u63a1\u7528\u767c\u4f48/\u8a02\u95b1\uff08Pub/Sub\uff09\u6a5f\u5236\uff0c\u8ca0\u8cac System Controller\u3001Task Generator\uff08Skald\uff09\u3001Task Worker \u4e4b\u9593\u7684\u4e8b\u4ef6\u50b3\u905e\u8207\u72c0\u614b\u540c\u6b65\u3002EventQueue \u5177\u5099\u9ad8\u541e\u5410\u91cf\u3001\u53ef\u9760\u6027\u8207\u5f48\u6027\u64f4\u5c55\u80fd\u529b\uff0c\u662f\u5206\u6563\u5f0f\u4efb\u52d9\u8abf\u5ea6\u7684\u6838\u5fc3\u901a\u8a0a\u6a1e\u7d10\u3002"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\u8a2d\u8a08\u7406\u5ff5",children:"\u8a2d\u8a08\u7406\u5ff5"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u4e8b\u4ef6\u9a45\u52d5"}),"\uff1a\u6240\u6709\u4efb\u52d9\u5efa\u7acb\u3001\u66f4\u65b0\u3001\u53d6\u6d88\u7b49\u64cd\u4f5c\u7686\u4ee5\u4e8b\u4ef6\u5f62\u5f0f\u6d41\u8f49\uff0c\u78ba\u4fdd\u72c0\u614b\u5373\u6642\u540c\u6b65\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u9b06\u8026\u5408\u67b6\u69cb"}),"\uff1a\u6a21\u7d44\u9593\u50c5\u900f\u904e\u4e8b\u4ef6\u4f47\u5217\u4e92\u52d5\uff0c\u964d\u4f4e\u8026\u5408\u5ea6\uff0c\u63d0\u5347\u7cfb\u7d71\u53ef\u7dad\u8b77\u6027\u8207\u64f4\u5c55\u6027\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u9ad8\u53ef\u7528\u8207\u9ad8\u6548\u80fd"}),"\uff1aKafka \u652f\u63f4\u591a\u526f\u672c\u3001\u5206\u5340\u8207\u81ea\u52d5\u5bb9\u932f\uff0c\u9069\u5408\u5927\u898f\u6a21\u5206\u6563\u5f0f\u5834\u666f\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u7121\u9700 Zookeeper"}),"\uff1a\u63a1\u7528 Kafka 3.9.0+\uff0c\u7c21\u5316\u90e8\u7f72\u8207\u7dad\u8b77\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\u67b6\u69cb\u8207\u89d2\u8272",children:"\u67b6\u69cb\u8207\u89d2\u8272"}),"\n",(0,r.jsx)(n.p,{children:"EventQueue \u4e3b\u8981\u8ca0\u8cac\u4ee5\u4e0b\u6a21\u7d44\u9593\u7684\u4e8b\u4ef6\u901a\u8a0a\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"System Controller"}),"\uff1a\u767c\u4f48\u4efb\u52d9\u5efa\u7acb\u3001\u66f4\u65b0\u3001\u53d6\u6d88\u7b49\u4e8b\u4ef6\uff0c\u76e3\u63a7\u4efb\u52d9\u72c0\u614b\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Task Generator\uff08Skald\uff09"}),"\uff1a\u63a5\u6536\u4e26\u8655\u7406\u8207\u81ea\u8eab ID \u76f8\u95dc\u7684\u4e8b\u4ef6\uff0c\u5206\u914d\u4efb\u52d9\u7d66 Task Worker\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Task Worker"}),"\uff1a\u76e3\u807d\u81ea\u8eab\u4efb\u52d9 ID \u7684\u4e8b\u4ef6\uff0c\u52d5\u614b\u8abf\u6574\u904b\u4f5c\u53c3\u6578\u6216\u7d42\u6b62\u4efb\u52d9\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u4e8b\u4ef6\u6d41\u793a\u610f\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"[System Controller] <-> [EventQueue (Kafka)] <-> [Skald] <-> [Task Worker]\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\u4e8b\u4ef6\u683c\u5f0f\u8207\u8cc7\u6599\u7d50\u69cb",children:"\u4e8b\u4ef6\u683c\u5f0f\u8207\u8cc7\u6599\u7d50\u69cb"}),"\n",(0,r.jsxs)(n.p,{children:["EventQueue \u6240\u6709\u4e8b\u4ef6\u7686\u4ee5\u7d50\u69cb\u5316 JSON \u683c\u5f0f\u50b3\u905e\uff0c\u4e26\u4ee5 Pydantic \u8cc7\u6599\u6a21\u578b\u9032\u884c\u9a57\u8b49\u3002\u4e3b\u8981\u4e8b\u4ef6\u683c\u5f0f\u5b9a\u7fa9\u65bc ",(0,r.jsx)(n.a,{href:"https://github.com/JiHungLin/skalds/blob/main/skalds/model/event.py",children:"skalds/model/event.py (GitHub)"}),"\uff1a"]}),"\n",(0,r.jsx)(n.h3,{id:"1-taskevent",children:"1. TaskEvent"}),"\n",(0,r.jsx)(n.p,{children:"\u7528\u65bc\u4efb\u52d9\u5206\u914d\u3001\u66f4\u65b0\u3001\u53d6\u6d88\u7b49\u4e8b\u4ef6\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'class TaskEvent(BaseModel):\n    id: Optional[str] = None\n    title: Optional[str] = None\n    initiator: Optional[str] = None\n    recipient: Optional[str] = None\n    create_date_time: int = Field(default_factory=lambda: int(datetime.now().timestamp() * 1000), alias="createDateTime")\n    update_date_time: int = Field(default_factory=lambda: int(datetime.now().timestamp() * 1000), alias="updateDateTime")\n    task_ids: list = Field(..., alias="taskIds")\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"id"}),"\uff1a\u4e8b\u4ef6\u552f\u4e00\u8b58\u5225\u78bc\uff08\u53ef\u9078\uff09"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"title"}),"\uff1a\u4e8b\u4ef6\u6a19\u984c\uff08\u53ef\u9078\uff09"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"initiator"}),"\uff1a\u4e8b\u4ef6\u767c\u8d77\u8005\uff08\u53ef\u9078\uff09"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"recipient"}),"\uff1a\u4e8b\u4ef6\u63a5\u6536\u8005\uff08\u53ef\u9078\uff09"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"createDateTime"}),"\uff1a\u5efa\u7acb\u6642\u9593\uff08\u6beb\u79d2\uff09"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"updateDateTime"}),"\uff1a\u66f4\u65b0\u6642\u9593\uff08\u6beb\u79d2\uff09"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"taskIds"}),"\uff1a\u53d7\u5f71\u97ff\u7684\u4efb\u52d9 ID \u5217\u8868\uff08\u5fc5\u586b\uff09"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"\u7bc4\u4f8b-payload",children:"\u7bc4\u4f8b payload"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "id": "evt_001",\n  "title": "Assign Task",\n  "initiator": "system_controller",\n  "recipient": "skalds-1",\n  "createDateTime": 1724131200000,\n  "updateDateTime": 1724131200000,\n  "taskIds": ["task_123"]\n}\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"2-updatetaskworkerevent",children:"2. UpdateTaskWorkerEvent"}),"\n",(0,r.jsx)(n.p,{children:"\u7528\u65bc Task Worker \u53c3\u6578\u71b1\u66f4\u65b0\u4e8b\u4ef6\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'class UpdateTaskWorkerEvent(BaseModel):\n    attachments: Optional[Any] = None  # \u5fc5\u9808\u70ba Pydantic BaseModel \u5be6\u4f8b\n\n    @field_validator("attachments", mode="before")\n    def validate_attachments(cls, v):\n        if v is None:\n            return v\n        if not isinstance(v, BaseModel):\n            raise ValueError("attachments must be a Pydantic BaseModel instance")\n        return v\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"attachments"}),"\uff1a\u4efb\u52d9\u53c3\u6578\uff08\u5fc5\u9808\u70ba Pydantic BaseModel \u5be6\u4f8b\uff0c\u578b\u5225\u5b89\u5168\uff09"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"\u7bc4\u4f8b-payload-1",children:"\u7bc4\u4f8b payload"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "attachments": {\n    "rtspUrl": "rtsp://192.168.1.1/camera1",\n    "fixFrame": 30\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u6ce8\u610f\uff1a"}),(0,r.jsx)(n.br,{}),"\n","attachments \u6b04\u4f4d\u5fc5\u9808\u7b26\u5408\u5c0d\u61c9 TaskWorker \u7684 Pydantic \u8cc7\u6599\u6a21\u578b\uff0c\u5426\u5247\u521d\u59cb\u5316\u6216\u66f4\u65b0\u6703\u5931\u6557\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\u4e8b\u4ef6\u751f\u547d\u9031\u671f\u4e2d\u7684\u89d2\u8272",children:"\u4e8b\u4ef6\u751f\u547d\u9031\u671f\u4e2d\u7684\u89d2\u8272"}),"\n",(0,r.jsx)(n.p,{children:"EventQueue \u5728\u4efb\u52d9\u751f\u547d\u9031\u671f\u7684\u4e09\u5927\u6d41\u7a0b\u4e2d\u626e\u6f14\u95dc\u9375\u89d2\u8272\uff1a"}),"\n",(0,r.jsx)(n.h3,{id:"1-\u4efb\u52d9\u5efa\u7acb",children:"1. \u4efb\u52d9\u5efa\u7acb"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"System Controller \u7522\u751f\u4efb\u52d9\u5f8c\uff0c\u767c\u4f48\u300c\u65b0\u589e\u4efb\u52d9\u4e8b\u4ef6\u300d\u81f3 EventQueue\u3002"}),"\n",(0,r.jsx)(n.li,{children:"Skald \u76e3\u807d\u4e26\u63a5\u6536\u8207\u81ea\u8eab ID \u76f8\u7b26\u7684\u4e8b\u4ef6\uff0c\u5efa\u7acb Task Worker\u3002"}),"\n",(0,r.jsx)(n.li,{children:"Task Worker \u555f\u52d5\u5f8c\uff0c\u5411 Redis \u8a3b\u518a\u72c0\u614b\u8207\u5fc3\u8df3\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"2-\u4efb\u52d9\u66f4\u65b0",children:"2. \u4efb\u52d9\u66f4\u65b0"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"System Controller \u767c\u4f48\u300c\u66f4\u65b0\u4efb\u52d9\u4e8b\u4ef6\u300d\u81f3 EventQueue\u3002"}),"\n",(0,r.jsx)(n.li,{children:"Skald \u63a5\u6536\u4e8b\u4ef6\uff0c\u67e5\u8a62\u4efb\u52d9\u7d30\u7bc0\uff0c\u4e26\u5c07\u66f4\u65b0\u4e8b\u4ef6\u8f49\u767c\u7d66\u5c0d\u61c9 Task Worker\u3002"}),"\n",(0,r.jsx)(n.li,{children:"Task Worker \u76e3\u807d\u81ea\u8eab\u4efb\u52d9 ID \u7684\u4e8b\u4ef6\uff0c\u52d5\u614b\u8abf\u6574\u53c3\u6578\u3002"}),"\n"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["\u8a73\u7d30\u6d41\u7a0b\u8acb\u53c3\u8003\uff1a",(0,r.jsx)(n.a,{href:"/Skalds/docs/documents/task_lifecycle",children:"\u4efb\u52d9\u751f\u547d\u9031\u671f"})]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"3-\u4efb\u52d9\u53d6\u6d88",children:"3. \u4efb\u52d9\u53d6\u6d88"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"System Controller \u767c\u4f48\u300c\u53d6\u6d88\u4efb\u52d9\u4e8b\u4ef6\u300d\u81f3 EventQueue\uff0c\u5ee3\u64ad\u7d66\u6240\u6709 Skald\u3002"}),"\n",(0,r.jsx)(n.li,{children:"Skald \u67e5\u8a62\u662f\u5426\u6709\u5c0d\u61c9 Task Worker\uff0c\u82e5\u6709\u5247\u95dc\u9589\u4e26\u91cb\u653e\u8cc7\u6e90\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\u6280\u8853\u9078\u578b\u8207-kafka-\u67b6\u69cb",children:"\u6280\u8853\u9078\u578b\u8207 Kafka \u67b6\u69cb"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Kafka \u7248\u672c\u9700\u6c42"}),"\uff1a\u5efa\u8b70 3.9.0+\uff0c\u652f\u63f4\u7121 Zookeeper \u90e8\u7f72\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u9ad8\u541e\u5410\u91cf"}),"\uff1a\u9069\u5408\u5927\u91cf\u4e8b\u4ef6\u6d41\u8207\u9ad8\u4f75\u767c\u5834\u666f\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u591a\u526f\u672c\u8207\u5206\u5340"}),"\uff1a\u63d0\u5347\u5bb9\u932f\u8207\u64f4\u5c55\u6027\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Pub/Sub \u6a5f\u5236"}),"\uff1a\u652f\u63f4\u591a\u6d88\u8cbb\u8005\u7fa4\u7d44\uff0c\u9748\u6d3b\u5206\u767c\u4e8b\u4ef6\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\u4e8b\u4ef6\u4e3b\u984ctopic\u8a2d\u8a08",children:"\u4e8b\u4ef6\u4e3b\u984c\uff08Topic\uff09\u8a2d\u8a08"}),"\n",(0,r.jsxs)(n.p,{children:["\u53c3\u8003 ",(0,r.jsx)(n.a,{href:"https://github.com/JiHungLin/skalds/blob/main/skalds/proxy/kafka.py",children:"skalds/proxy/kafka.py (GitHub)"}),"\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"task.assign"}),"\uff1a\u4efb\u52d9\u5206\u914d\u4e8b\u4ef6"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"task.cancel"}),"\uff1a\u4efb\u52d9\u53d6\u6d88\u4e8b\u4ef6"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"task.update.attachment"}),"\uff1a\u4efb\u52d9\u53c3\u6578\u66f4\u65b0\u4e8b\u4ef6"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"taskworker.update"}),"\uff1aTask Worker \u72c0\u614b\u66f4\u65b0\u4e8b\u4ef6"]}),"\n"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u6ce8\u610f\uff1a"}),(0,r.jsx)(n.br,{}),"\n","\u4e0d\u5efa\u8b70\u70ba\u6bcf\u500b\u4efb\u52d9\u52d5\u614b\u7522\u751f ",(0,r.jsx)(n.code,{children:"task.{task_id}.update"})," \u9019\u985e per-task topic\uff0c\u56e0\u70ba\u6703\u5c0e\u81f4 topic \u6578\u91cf\u7206\u70b8\uff0c\u56b4\u91cd\u5f71\u97ff Kafka \u6548\u80fd\u8207\u7ba1\u7406\u3002",(0,r.jsx)(n.br,{}),"\n","\u8acb\u7d71\u4e00\u4f7f\u7528\u5171\u7528 topic\uff08\u5982 ",(0,r.jsx)(n.code,{children:"task.update.attachment"}),"\uff09\uff0c\u4e26\u4ee5 message key \u6216 payload \u5167\u7684 task_id \u505a\u904e\u6ffe\u8207\u5206\u6d41\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"kafka-proxy-\u4ecb\u9762\u8aaa\u660e",children:"Kafka Proxy \u4ecb\u9762\u8aaa\u660e"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://github.com/JiHungLin/skalds/blob/main/skalds/proxy/kafka.py",children:"skalds/proxy/kafka.py (GitHub)"})," \u63d0\u4f9b\u9ad8\u968e Kafka \u64cd\u4f5c\u4ecb\u9762\uff0c\u5e38\u7528\u65b9\u6cd5\u5982\u4e0b\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"produce(topic_name, key, value)"}),"\uff1a\u767c\u4f48\u4e8b\u4ef6\u81f3\u6307\u5b9a\u4e3b\u984c"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"KafkaConfig"}),"\uff1a\u914d\u7f6e Kafka \u9023\u7dda\u53c3\u6578\uff08host\u3001port\u3001topic\u3001\u7fa4\u7d44 ID\u3001\u8a8d\u8b49\u7b49\uff09"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"KafkaAdmin"}),"\uff1a\u4e3b\u984c\u7ba1\u7406\uff08\u5efa\u7acb\u3001\u522a\u9664\u3001\u67e5\u8a62\uff09"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"\u5178\u578b\u7528\u6cd5",children:"\u5178\u578b\u7528\u6cd5"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from skalds.proxy.kafka import KafkaProxy, KafkaConfig, KafkaTopic\n\n# \u521d\u59cb\u5316 Kafka \u9023\u7dda\nkafka_proxy = KafkaProxy(KafkaConfig(host="localhost", port=9092))\n\n# \u767c\u4f48\u4efb\u52d9\u5206\u914d\u4e8b\u4ef6\nfrom skalds.model.event import TaskEvent\nevent = TaskEvent(taskIds=["task_123"], initiator="system_controller", recipient="skalds-1")\nkafka_proxy.produce(KafkaTopic.TASK_ASSIGN, key="task_123", value=event.model_dump_json())\n\n# \u767c\u4f48\u4efb\u52d9\u53c3\u6578\u66f4\u65b0\u4e8b\u4ef6\uff08\u5171\u7528 topic\uff0ckey \u70ba task_id\uff09\nfrom skalds.model.event import UpdateTaskWorkerEvent\nupdate_event = UpdateTaskWorkerEvent(attachments=...)\nkafka_proxy.produce(KafkaTopic.TASK_UPDATE_ATTACHMENT, key="task_123", value=update_event.model_dump_json())\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\u5178\u578b\u61c9\u7528\u5834\u666f",children:"\u5178\u578b\u61c9\u7528\u5834\u666f"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u4efb\u52d9\u5206\u914d\u8207\u8abf\u5ea6"}),"\uff1aSystem Controller \u900f\u904e EventQueue \u5c07\u4efb\u52d9\u5206\u914d\u7d66\u6307\u5b9a Skald\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u52d5\u614b\u53c3\u6578\u71b1\u66f4\u65b0"}),"\uff1a\u4efb\u52d9\u57f7\u884c\u4e2d\uff0c\u900f\u904e EventQueue \u767c\u9001\u53c3\u6578\u66f4\u65b0\u4e8b\u4ef6\uff0cTask Worker \u5373\u6642\u8abf\u6574\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u4efb\u52d9\u53d6\u6d88\u8207\u7d42\u6b62"}),"\uff1a\u5ee3\u64ad\u53d6\u6d88\u4e8b\u4ef6\uff0c\u78ba\u4fdd\u6240\u6709\u76f8\u95dc\u7bc0\u9ede\u540c\u6b65\u7d42\u6b62\u4efb\u52d9\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u72c0\u614b\u76e3\u63a7\u8207\u56de\u5831"}),"\uff1aTask Worker \u53ef\u56de\u5831\u72c0\u614b\u81f3 EventQueue\uff0c\u4f9b System Controller \u76e3\u63a7\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\u6548\u80fd\u512a\u5316\u8207\u6ce8\u610f\u4e8b\u9805",children:"\u6548\u80fd\u512a\u5316\u8207\u6ce8\u610f\u4e8b\u9805"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u5206\u5340\u8a2d\u8a08"}),"\uff1a\u6839\u64da\u4efb\u52d9\u91cf\u8207\u6d88\u8cbb\u8005\u6578\u91cf\u5408\u7406\u8a2d\u8a08\u5206\u5340\u6578\uff0c\u63d0\u5347\u4f75\u767c\u8655\u7406\u80fd\u529b\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u4e3b\u984c\u547d\u540d\u898f\u7bc4"}),"\uff1a\u5efa\u8b70\u4ee5\u529f\u80fd/\u4efb\u52d9\u985e\u578b\u5340\u5206\u4e3b\u984c\uff0c\u4fbf\u65bc\u7dad\u8b77\u8207\u76e3\u63a7\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u907f\u514d per-task topic"}),"\uff1a\u6240\u6709\u4e8b\u4ef6\u8acb\u7d71\u4e00\u767c\u4f48\u81f3\u5171\u7528\u4e3b\u984c\uff0c\u907f\u514d\u52d5\u614b\u7522\u751f\u5927\u91cf topic\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u9023\u7dda\u91cd\u8a66\u8207\u5bb9\u932f"}),"\uff1aKafkaProxy \u5167\u5efa\u81ea\u52d5\u91cd\u9023\u8207\u932f\u8aa4\u8655\u7406\u6a5f\u5236\uff0c\u63d0\u5347\u7a69\u5b9a\u6027\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u5b89\u5168\u6027"}),"\uff1a\u5982\u9700\u96f2\u7aef\u90e8\u7f72\uff0c\u5efa\u8b70\u555f\u7528 SASL/SSL \u8a8d\u8b49\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\u90e8\u7f72\u5efa\u8b70",children:"\u90e8\u7f72\u5efa\u8b70"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u5efa\u8b70\u7248\u672c"}),"\uff1aKafka 3.9.0+\uff08\u7121\u9700 Zookeeper\uff09"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u591a\u526f\u672c\u90e8\u7f72"}),"\uff1a\u63d0\u5347\u9ad8\u53ef\u7528\u6027\u8207\u5bb9\u932f\u80fd\u529b"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u76e3\u63a7\u5de5\u5177"}),"\uff1a\u53ef\u7d50\u5408 Kafka Manager\u3001Prometheus \u7b49\u5de5\u5177\u76e3\u63a7\u4e3b\u984c\u6d41\u91cf\u8207\u5ef6\u9072"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u8207 Redis/MongoDB \u6574\u5408"}),"\uff1a\u4e8b\u4ef6\u6d41\u50c5\u8ca0\u8cac\u901a\u8a0a\uff0c\u72c0\u614b\u8cc7\u6599\u4ecd\u5efa\u8b70\u540c\u6b65\u81f3 Redis/MongoDB"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\u53c3\u8003\u6587\u4ef6\u8207\u5ef6\u4f38\u95b1\u8b80",children:"\u53c3\u8003\u6587\u4ef6\u8207\u5ef6\u4f38\u95b1\u8b80"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://kafka.apache.org/documentation/",children:"Kafka \u5b98\u65b9\u6587\u4ef6"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/Skalds/docs/intro",children:"Skalds \u67b6\u69cb\u8207\u6a21\u7d44\u7d30\u7bc0"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/Skalds/docs/documents/task_lifecycle",children:"\u4efb\u52d9\u751f\u547d\u9031\u671f\u8207\u4e8b\u4ef6\u6d41"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/Skalds/docs/documents/task_worker",children:"Task Worker \u8a73\u7d30\u8aaa\u660e"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/Skalds/docs/documents/cache_memory",children:"Cache Memory \u5feb\u53d6\u8aaa\u660e"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/Skalds/docs/documents/yaml_config",children:"YAML \u914d\u7f6e\u8aaa\u660e"})}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.p,{children:"EventQueue \u662f Skalds \u5206\u6563\u5f0f\u4efb\u52d9\u8abf\u5ea6\u7cfb\u7d71\u7684\u901a\u8a0a\u6838\u5fc3\uff0c\u6b63\u78ba\u8a2d\u8a08\u8207\u5584\u7528\u53ef\u5927\u5e45\u63d0\u5347\u7cfb\u7d71\u7684\u5373\u6642\u6027\u3001\u5f48\u6027\u8207\u53ef\u7dad\u8b77\u6027\u3002"})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},9863:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>d});var l=s(9729);const r={},i=l.createContext(r);function a(e){const n=l.useContext(i);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),l.createElement(i.Provider,{value:n},e.children)}}}]);