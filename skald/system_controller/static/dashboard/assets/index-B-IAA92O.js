var Ce=Object.defineProperty;var Ee=(s,e,a)=>e in s?Ce(s,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[e]=a;var M=(s,e,a)=>Ee(s,typeof e!="symbol"?e+"":e,a);import{j as t,u as X,a as Me,Q as De,b as Oe}from"./query-C6o_FDNk.js";import{a as Pe,r as o,b as Ae}from"./vendor-Gm9i_4Ku.js";import{u as Fe,L as ae,a as We,R as Le,b as Z,B as Re}from"./router-jua2Vyaz.js";import{u as $e,f as re,g as Ie,a as He}from"./table-iqIhI9LJ.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const m of i.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&r(m)}).observe(document,{childList:!0,subtree:!0});function a(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=a(n);fetch(n.href,i)}})();var se={},ne=Pe;se.createRoot=ne.createRoot,se.hydrateRoot=ne.hydrateRoot;function Ye({title:s,titleId:e,...a},r){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},a),s?o.createElement("title",{id:e},s):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"}))}const qe=o.forwardRef(Ye);function _e({title:s,titleId:e,...a},r){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},a),s?o.createElement("title",{id:e},s):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const Be=o.forwardRef(_e);function Ve({title:s,titleId:e,...a},r){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},a),s?o.createElement("title",{id:e},s):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"}))}const Qe=o.forwardRef(Ve);function Ue({title:s,titleId:e,...a},r){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},a),s?o.createElement("title",{id:e},s):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m4.5 15.75 7.5-7.5 7.5 7.5"}))}const Xe=o.forwardRef(Ue);function Ge({title:s,titleId:e,...a},r){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},a),s?o.createElement("title",{id:e},s):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z"}))}const fe=o.forwardRef(Ge);function ze({title:s,titleId:e,...a},r){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},a),s?o.createElement("title",{id:e},s):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"}))}const Je=o.forwardRef(ze);function Ke({title:s,titleId:e,...a},r){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},a),s?o.createElement("title",{id:e},s):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 17.25v-.228a4.5 4.5 0 0 0-.12-1.03l-2.268-9.64a3.375 3.375 0 0 0-3.285-2.602H7.923a3.375 3.375 0 0 0-3.285 2.602l-2.268 9.64a4.5 4.5 0 0 0-.12 1.03v.228m19.5 0a3 3 0 0 1-3 3H5.25a3 3 0 0 1-3-3m19.5 0a3 3 0 0 0-3-3H5.25a3 3 0 0 0-3 3m16.5 0h.008v.008h-.008v-.008Zm-3 0h.008v.008h-.008v-.008Z"}))}const xe=o.forwardRef(Ke);function Ze({title:s,titleId:e,...a},r){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},a),s?o.createElement("title",{id:e},s):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.288 15.038a5.25 5.25 0 0 1 7.424 0M5.106 11.856c3.807-3.808 9.98-3.808 13.788 0M1.924 8.674c5.565-5.565 14.587-5.565 20.152 0M12.53 18.22l-.53.53-.53-.53a.75.75 0 0 1 1.06 0Z"}))}const ge=o.forwardRef(Ze);function et({title:s,titleId:e,...a},r){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},a),s?o.createElement("title",{id:e},s):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const B=o.forwardRef(et);function tt({title:s,titleId:e,...a},r){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},a),s?o.createElement("title",{id:e},s):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"}))}const st=o.forwardRef(tt),ie=[{name:"Dashboard",href:"/",icon:Je},{name:"Skalds",href:"/skalds",icon:xe},{name:"Tasks",href:"/tasks",icon:fe}];function at({children:s}){const[e,a]=o.useState(!1),r=Fe();return t.jsxs("div",{className:"min-h-screen bg-gray-50",children:[t.jsxs("div",{className:`fixed inset-0 z-40 lg:hidden ${e?"":"hidden"}`,children:[t.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-75",onClick:()=>a(!1)}),t.jsxs("div",{className:"relative flex w-full max-w-xs flex-1 flex-col bg-white",children:[t.jsx("div",{className:"absolute top-0 right-0 -mr-12 pt-2",children:t.jsx("button",{type:"button",className:"ml-1 flex h-10 w-10 items-center justify-center rounded-full focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white",onClick:()=>a(!1),children:t.jsx(st,{className:"h-6 w-6 text-white"})})}),t.jsxs("div",{className:"h-0 flex-1 overflow-y-auto pt-5 pb-4",children:[t.jsx("div",{className:"flex flex-shrink-0 items-center px-4",children:t.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Skald Dashboard"})}),t.jsx("nav",{className:"mt-5 space-y-1 px-2",children:ie.map(n=>{const i=r.pathname===n.href;return t.jsxs(ae,{to:n.href,className:`group flex items-center px-2 py-2 text-base font-medium rounded-md ${i?"bg-primary-100 text-primary-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"}`,onClick:()=>a(!1),children:[t.jsx(n.icon,{className:`mr-4 h-6 w-6 flex-shrink-0 ${i?"text-primary-500":"text-gray-400 group-hover:text-gray-500"}`}),n.name]},n.name)})})]})]})]}),t.jsx("div",{className:"hidden lg:fixed lg:inset-y-0 lg:flex lg:w-64 lg:flex-col",children:t.jsx("div",{className:"flex min-h-0 flex-1 flex-col bg-white border-r border-gray-200",children:t.jsxs("div",{className:"flex flex-1 flex-col overflow-y-auto pt-5 pb-4",children:[t.jsx("div",{className:"flex flex-shrink-0 items-center px-4",children:t.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Skald Dashboard"})}),t.jsx("nav",{className:"mt-5 flex-1 space-y-1 px-2",children:ie.map(n=>{const i=r.pathname===n.href;return t.jsxs(ae,{to:n.href,className:`group flex items-center px-2 py-2 text-sm font-medium rounded-md ${i?"bg-primary-100 text-primary-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"}`,children:[t.jsx(n.icon,{className:`mr-3 h-6 w-6 flex-shrink-0 ${i?"text-primary-500":"text-gray-400 group-hover:text-gray-500"}`}),n.name]},n.name)})})]})})}),t.jsxs("div",{className:"lg:pl-64",children:[t.jsx("div",{className:"sticky top-0 z-10 bg-white border-b border-gray-200 lg:hidden",children:t.jsxs("div",{className:"flex h-16 items-center justify-between px-4",children:[t.jsx("button",{type:"button",className:"border-r border-gray-200 px-4 text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary-500 lg:hidden",onClick:()=>a(!0),children:t.jsx(qe,{className:"h-6 w-6"})}),t.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"Skald Dashboard"}),t.jsx("div",{className:"w-10"})," "]})}),t.jsx("main",{className:"flex-1",children:t.jsx("div",{className:"py-6",children:t.jsx("div",{className:"w-full px-4 sm:px-6 lg:px-8",children:s})})})]})]})}const U=[{id:"skald-node-001",type:"node",status:"online",lastHeartbeat:new Date().toISOString(),supportedTasks:["data_processing","ml_training","file_conversion"],currentTasks:["task-001","task-003"]},{id:"skald-node-002",type:"node",status:"online",lastHeartbeat:new Date(Date.now()-3e4).toISOString(),supportedTasks:["data_processing","image_processing"],currentTasks:["task-002"]},{id:"skald-edge-001",type:"edge",status:"offline",lastHeartbeat:new Date(Date.now()-3e5).toISOString(),supportedTasks:["sensor_data","edge_computing"],currentTasks:[]}],$=[{id:"task-001",mode:"Active",className:"data_processing",lifecycleStatus:"Running",executor:"skald-node-001",createDateTime:new Date(Date.now()-36e5).toISOString(),updateDateTime:new Date(Date.now()-18e5).toISOString(),attachments:{inputFile:"data.csv",outputPath:"/tmp/processed"},heartbeat:150,error:void 0,exception:void 0},{id:"task-002",mode:"Active",className:"ml_training",lifecycleStatus:"Running",executor:"skald-node-002",createDateTime:new Date(Date.now()-72e5).toISOString(),updateDateTime:new Date(Date.now()-9e5).toISOString(),attachments:{model:"neural_network",dataset:"training_data.json"},heartbeat:75,error:void 0,exception:void 0},{id:"task-003",mode:"Active",className:"file_conversion",lifecycleStatus:"Finished",executor:"skald-node-001",createDateTime:new Date(Date.now()-18e5).toISOString(),updateDateTime:new Date(Date.now()-3e5).toISOString(),attachments:{sourceFile:"document.pdf",targetFormat:"docx"},heartbeat:200,error:void 0,exception:void 0},{id:"task-004",mode:"Active",className:"data_processing",lifecycleStatus:"Failed",executor:"skald-node-002",createDateTime:new Date(Date.now()-54e5).toISOString(),updateDateTime:new Date(Date.now()-36e5).toISOString(),attachments:{inputFile:"corrupted_data.csv"},heartbeat:-1,error:"File format not supported",exception:"ValueError: Invalid data format"},{id:"task-005",mode:"Active",className:"image_processing",lifecycleStatus:"Created",executor:void 0,createDateTime:new Date(Date.now()-6e5).toISOString(),updateDateTime:new Date(Date.now()-6e5).toISOString(),attachments:{images:["img1.jpg","img2.jpg"],filter:"blur"},heartbeat:0,error:void 0,exception:void 0}];class rt{constructor(){M(this,"baseUrl");M(this,"useMockData",!1);this.baseUrl="http://localhost:8000",this.useMockData=!1,console.log(`API Client initialized - Base URL: ${this.baseUrl}, Mock Data: ${this.useMockData}`)}async fetchApi(e,a){const r=`${this.baseUrl}${e}`;console.log(`Making API call to: ${r}`);try{const n=await fetch(r,{headers:{"Content-Type":"application/json",...a==null?void 0:a.headers},...a});if(!n.ok)throw console.error(`API call failed: ${n.status} ${n.statusText}`),new Error(`HTTP error! status: ${n.status} - ${n.statusText}`);const i=await n.json();return console.log(`API call successful for ${e}:`,i),i}catch(n){throw console.error(`API call failed for ${e}:`,n),n}}getMockData(e){if(e.includes("/api/skalds"))return{items:U,total:U.length};if(e.includes("/api/tasks"))return{items:$,total:$.length,page:1,pageSize:20};if(e.includes("/api/system/dashboard/summary"))return{totalSkalds:U.length,onlineSkalds:U.filter(a=>a.status==="online").length,totalTasks:$.length,runningTasks:$.filter(a=>a.lifecycleStatus==="Running").length,finishedTasks:$.filter(a=>a.lifecycleStatus==="Finished").length,failedTasks:$.filter(a=>a.lifecycleStatus==="Failed").length};throw new Error(`No mock data available for ${e}`)}async getSkalds(){return this.fetchApi("/api/skalds/")}async getSkald(e){return this.fetchApi(`/api/skalds/${e}`)}async getTasks(e){const a=new URLSearchParams({page:e.page.toString(),pageSize:e.pageSize.toString()});return e.lifecycleStatus&&a.append("lifecycleStatus",e.lifecycleStatus),e.className&&a.append("className",e.className),e.executor&&a.append("executor",e.executor),e.id&&a.append("id",e.id),this.fetchApi(`/api/tasks/?${a.toString()}`)}async getTaskClassNames(){return this.fetchApi("/api/tasks/classnames")}async getTask(e){return this.fetchApi(`/api/tasks/${e}`)}async updateTaskStatus(e,a){return this.fetchApi(`/api/tasks/${e}/status`,{method:"PUT",body:JSON.stringify(a)})}async updateTaskAttachments(e,a){return this.fetchApi(`/api/tasks/${e}/attachments`,{method:"PUT",body:JSON.stringify(a)})}async getDashboardSummary(){return this.fetchApi("/api/system/dashboard/summary")}}const Y=new rt;function pe(s){var e,a,r="";if(typeof s=="string"||typeof s=="number")r+=s;else if(typeof s=="object")if(Array.isArray(s)){var n=s.length;for(e=0;e<n;e++)s[e]&&(a=pe(s[e]))&&(r&&(r+=" "),r+=a)}else for(a in s)s[a]&&(r&&(r+=" "),r+=a);return r}function ee(){for(var s,e,a=0,r="",n=arguments.length;a<n;a++)(s=arguments[a])&&(e=pe(s))&&(r&&(r+=" "),r+=e);return r}const nt={online:{color:"status-online",label:"Online",dotColor:"bg-success-500"},offline:{color:"status-offline",label:"Offline",dotColor:"bg-gray-500"},Created:{color:"status-created",label:"Created",dotColor:"bg-warning-500"},Assigning:{color:"status-assigning",label:"Assigning",dotColor:"bg-warning-500"},Running:{color:"status-running",label:"Running",dotColor:"bg-primary-500"},Paused:{color:"status-paused",label:"Paused",dotColor:"bg-warning-500"},Finished:{color:"status-finished",label:"Finished",dotColor:"bg-success-500"},Failed:{color:"status-failed",label:"Failed",dotColor:"bg-danger-500"},Cancelled:{color:"status-cancelled",label:"Cancelled",dotColor:"bg-gray-500"}},it={sm:{badge:"px-2 py-1 text-xs",dot:"w-2 h-2"},md:{badge:"px-2.5 py-1.5 text-sm",dot:"w-3 h-3"},lg:{badge:"px-3 py-2 text-base",dot:"w-4 h-4"}};function H({status:s,size:e="md",showLabel:a=!0,animated:r=!1}){const n=nt[s],i=it[e];return n?a?t.jsxs("span",{className:ee("inline-flex items-center gap-1.5 rounded-full border font-medium",n.color,i.badge),children:[t.jsx("div",{className:ee("rounded-full",i.dot,n.dotColor,r&&(s==="online"||s==="Running")&&"animate-heartbeat")}),n.label]}):t.jsx("div",{className:"flex items-center",children:t.jsx("div",{className:ee("rounded-full",i.dot,n.dotColor,r&&(s==="online"||s==="Running")&&"animate-pulse")})}):null}function ot(){const s=We(),{data:e,isLoading:a,error:r}=X({queryKey:["dashboard-summary"],queryFn:()=>Y.getDashboardSummary(),retry:2,retryDelay:1e3});if(o.useEffect(()=>{console.log("Dashboard component mounted - API call status:",{isLoading:a,error:r,summary:e})},[a,r,e]),r)return console.error("Dashboard API error:",r),t.jsx("div",{className:"space-y-6",children:t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:t.jsxs("div",{className:"flex",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(B,{className:"h-5 w-5 text-red-400"})}),t.jsxs("div",{className:"ml-3",children:[t.jsx("h3",{className:"text-sm font-medium text-red-800",children:"API Connection Error"}),t.jsxs("div",{className:"mt-2 text-sm text-red-700",children:[t.jsx("p",{children:"Failed to load dashboard data. Please check:"}),t.jsxs("ul",{className:"list-disc list-inside mt-1",children:[t.jsx("li",{children:"SystemController backend is running"}),t.jsx("li",{children:"API endpoints are accessible"}),t.jsx("li",{children:"Network connectivity"})]}),t.jsxs("p",{className:"mt-2 font-mono text-xs bg-red-100 p-2 rounded",children:["Error: ",r instanceof Error?r.message:"Unknown error"]})]}),t.jsx("div",{className:"mt-4",children:t.jsx("button",{onClick:()=>window.location.reload(),className:"btn btn-sm btn-primary",children:"Retry"})})]})]})})});if(a)return t.jsx("div",{className:"space-y-6",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-6"}),t.jsx("div",{className:"grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4",children:[...Array(4)].map((i,m)=>t.jsx("div",{className:"card",children:t.jsxs("div",{className:"card-content",children:[t.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),t.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/2"})]})},m))})]})});const n=[{name:"Total Skalds",value:(e==null?void 0:e.totalSkalds)||0,subValue:`${(e==null?void 0:e.onlineSkalds)||0} online`,icon:xe,color:"text-primary-600",bgColor:"bg-primary-100"},{name:"Total Tasks",value:(e==null?void 0:e.totalTasks)||0,subValue:`${(e==null?void 0:e.runningTasks)||0} running`,icon:fe,color:"text-blue-600",bgColor:"bg-blue-100"},{name:"Finished Tasks",value:(e==null?void 0:e.finishedTasks)||0,subValue:"Successfully finished",icon:Be,color:"text-success-600",bgColor:"bg-success-100"},{name:"Failed Tasks",value:(e==null?void 0:e.failedTasks)||0,subValue:"Need attention",icon:B,color:"text-danger-600",bgColor:"bg-danger-100"}];return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Dashboard"}),t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Overview of your Skald system status and performance"})]}),t.jsx("div",{className:"grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4",children:n.map(i=>t.jsx("div",{className:"card",children:t.jsx("div",{className:"card-content",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx("div",{className:`p-3 rounded-lg ${i.bgColor}`,children:t.jsx(i.icon,{className:`h-6 w-6 ${i.color}`})})}),t.jsxs("div",{className:"ml-4 flex-1",children:[t.jsx("div",{className:"text-sm font-medium text-gray-500",children:i.name}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:i.value}),t.jsx("div",{className:"text-xs text-gray-400",children:i.subValue})]})]})})},i.name))}),t.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:[t.jsxs("div",{className:"card",children:[t.jsx("div",{className:"card-header",children:t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"System Status"})}),t.jsxs("div",{className:"card-content space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Skald Connectivity"}),t.jsxs("span",{className:"text-xs text-gray-500",children:[(e==null?void 0:e.onlineSkalds)||0," of ",(e==null?void 0:e.totalSkalds)||0," skalds online"]})]}),t.jsx("div",{className:"flex items-center space-x-2",children:(()=>{const i=e!=null&&e.totalSkalds?e.onlineSkalds/e.totalSkalds:0;return i===1?t.jsx("div",{title:"Status: Online - All Skald nodes are connected and operational",children:t.jsx(H,{status:"online",animated:!0})}):i>=.7?t.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1.5 text-sm bg-warning-100 text-warning-800 border-warning-200 cursor-help",title:`Status: Partial - ${Math.round(i*100)}% of skalds online (≥70% threshold met, but not all nodes available)`,children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-warning-500 animate-pulse"}),"Partial"]}):i>0?t.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1.5 text-sm bg-danger-100 text-danger-800 border-danger-200 cursor-help",title:`Status: Degraded - Only ${Math.round(i*100)}% of skalds online (<70% threshold, system performance may be impacted)`,children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-danger-500 animate-pulse"}),"Degraded"]}):t.jsx("div",{title:"Status: Offline - No Skald nodes are currently connected",children:t.jsx(H,{status:"offline",animated:!0})})})()})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Task Processing"}),t.jsx("span",{className:"text-xs text-gray-500",children:(()=>{const i=(e==null?void 0:e.runningTasks)||0,m=(e==null?void 0:e.finishedTasks)||0,h=(e==null?void 0:e.failedTasks)||0;return i===0&&m===0&&h>0?"0 running, 0 finished, all failed":`${i} running, ${m} finished`})()})]}),t.jsx("div",{className:"flex items-center space-x-2",children:(()=>{const i=(e==null?void 0:e.runningTasks)||0,m=(e==null?void 0:e.failedTasks)||0;return i>0?t.jsx("div",{title:`Status: Running - ${i} task(s) currently being processed`,children:t.jsx(H,{status:"Running",animated:!0})}):m===0?t.jsx("div",{title:"Status: Finished - No active tasks, all previous tasks finished successfully",children:t.jsx(H,{status:"Finished"})}):t.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1.5 text-sm bg-warning-100 text-warning-800 border-warning-200 cursor-help",title:`Status: Idle - No tasks running, but ${m} failed task(s) require attention`,children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-warning-500"}),"Idle"]})})()})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-sm font-medium text-gray-900",children:"System Health"}),t.jsxs("span",{className:"text-xs text-gray-500",children:[(e==null?void 0:e.failedTasks)||0," failed tasks detected"]})]}),t.jsx("div",{className:"flex items-center space-x-2",children:(()=>{const i=(e==null?void 0:e.failedTasks)||0,m=(e==null?void 0:e.totalTasks)||0,h=m>0?i/m:0;return i===0?t.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1.5 text-sm bg-success-100 text-success-800 border-success-200 cursor-help",title:"Status: Healthy - No failed tasks detected, system operating normally",children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-success-500"}),"Healthy"]}):h<.1?t.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1.5 text-sm bg-warning-100 text-warning-800 border-warning-200 cursor-help",title:`Status: Warning - ${i} failed task(s), failure rate ${Math.round(h*100)}% (<10% threshold, monitor closely)`,children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-warning-500 animate-pulse"}),"Warning"]}):t.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1.5 text-sm bg-danger-100 text-danger-800 border-danger-200 cursor-help",title:`Status: Critical - ${i} failed task(s), failure rate ${Math.round(h*100)}% (≥10% threshold, immediate attention required)`,children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-danger-500 animate-pulse"}),"Critical"]})})()})]})]})]}),t.jsxs("div",{className:"card",children:[t.jsx("div",{className:"card-header",children:t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Quick Actions"})}),t.jsxs("div",{className:"card-content space-y-3",children:[t.jsx("button",{className:"btn btn-primary btn-md w-full",onClick:()=>s("/tasks"),children:"View All Tasks"}),t.jsx("button",{className:"btn btn-primary btn-md w-full",onClick:()=>s("/skalds"),children:"Monitor Skalds"}),t.jsx("button",{className:"btn btn-primary btn-md w-full",onClick:()=>alert("System Logs feature coming soon!"),children:"System Logs"})]})]})]}),t.jsxs("div",{className:"card",children:[t.jsxs("div",{className:"card-header",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Status Legend"}),t.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Understanding system status indicators and their logic"})]}),t.jsx("div",{className:"card-content",children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full text-sm",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"border-b border-gray-200",children:[t.jsx("th",{className:"text-left py-3 font-medium text-gray-900",children:"Category"}),t.jsx("th",{className:"text-left py-3 font-medium text-gray-900",children:"Status"}),t.jsx("th",{className:"text-left py-3 font-medium text-gray-900",children:"Logic & Conditions"})]})}),t.jsxs("tbody",{className:"divide-y divide-gray-100",children:[t.jsxs("tr",{children:[t.jsx("td",{rowSpan:4,className:"py-3 font-medium text-gray-900 align-top border-r border-gray-100",children:"Skald Connectivity"}),t.jsx("td",{className:"py-3",children:t.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1 text-xs bg-success-100 text-success-800 border-success-200",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-success-500"}),"Online"]})}),t.jsx("td",{className:"py-3 text-gray-600",children:"All Skald nodes are connected and operational (100% online)"})]}),t.jsxs("tr",{children:[t.jsx("td",{className:"py-3",children:t.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1 text-xs bg-warning-100 text-warning-800 border-warning-200",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-warning-500"}),"Partial"]})}),t.jsx("td",{className:"py-3 text-gray-600",children:"≥70% of skalds online, but not all nodes are available"})]}),t.jsxs("tr",{children:[t.jsx("td",{className:"py-3",children:t.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1 text-xs bg-danger-100 text-danger-800 border-danger-200",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-danger-500"}),"Degraded"]})}),t.jsx("td",{className:"py-3 text-gray-600",children:"<70% of skalds online, system performance may be impacted"})]}),t.jsxs("tr",{children:[t.jsx("td",{className:"py-3",children:t.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1 text-xs bg-gray-100 text-gray-800 border-gray-200",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-gray-500"}),"Offline"]})}),t.jsx("td",{className:"py-3 text-gray-600",children:"No Skald nodes are currently connected (0% online)"})]}),t.jsxs("tr",{children:[t.jsx("td",{rowSpan:3,className:"py-3 font-medium text-gray-900 align-top border-r border-gray-100",children:"Task Processing"}),t.jsx("td",{className:"py-3",children:t.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1 text-xs bg-primary-100 text-primary-800 border-primary-200",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-primary-500"}),"Running"]})}),t.jsx("td",{className:"py-3 text-gray-600",children:"One or more tasks are currently being processed"})]}),t.jsxs("tr",{children:[t.jsx("td",{className:"py-3",children:t.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1 text-xs bg-success-100 text-success-800 border-success-200",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-success-500"}),"Finished"]})}),t.jsx("td",{className:"py-3 text-gray-600",children:"No active tasks, all previous tasks finished successfully"})]}),t.jsxs("tr",{children:[t.jsx("td",{className:"py-3",children:t.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1 text-xs bg-warning-100 text-warning-800 border-warning-200",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-warning-500"}),"Idle"]})}),t.jsx("td",{className:"py-3 text-gray-600",children:"No tasks currently running, but failed tasks exist and require attention"})]}),t.jsxs("tr",{children:[t.jsx("td",{rowSpan:3,className:"py-3 font-medium text-gray-900 align-top border-r border-gray-100",children:"System Health"}),t.jsx("td",{className:"py-3",children:t.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1 text-xs bg-success-100 text-success-800 border-success-200",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-success-500"}),"Healthy"]})}),t.jsx("td",{className:"py-3 text-gray-600",children:"No failed tasks detected, system operating normally (0% failure rate)"})]}),t.jsxs("tr",{children:[t.jsx("td",{className:"py-3",children:t.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1 text-xs bg-warning-100 text-warning-800 border-warning-200",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-warning-500"}),"Warning"]})}),t.jsx("td",{className:"py-3 text-gray-600",children:"Task failure rate <10%, system should be monitored closely"})]}),t.jsxs("tr",{children:[t.jsx("td",{className:"py-3",children:t.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1 text-xs bg-danger-100 text-danger-800 border-danger-200",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-danger-500"}),"Critical"]})}),t.jsx("td",{className:"py-3 text-gray-600",children:"Task failure rate ≥10%, immediate attention and intervention required"})]})]})]})})})]})]})}function be({data:s,columns:e,loading:a=!1,pagination:r,onRowClick:n}){const[i,m]=o.useState([]),h=e.map(c=>({accessorKey:c.key,header:c.header,enableSorting:c.sortable??!0,cell:({getValue:u,row:v})=>{const T=u();return c.render?c.render(T,v.original):String(T)}})),b=$e({data:s,columns:h,state:{sorting:i},onSortingChange:m,getCoreRowModel:He(),getSortedRowModel:Ie()});return a?t.jsx("div",{className:"card",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"card-header",children:t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"})}),t.jsx("div",{className:"card-content space-y-3",children:[...Array(5)].map((c,u)=>t.jsx("div",{className:"h-4 bg-gray-200 rounded"},u))})]})}):t.jsxs("div",{className:"card",children:[t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{children:b.getHeaderGroups().map(c=>t.jsx("tr",{className:"border-b border-gray-200",children:c.headers.map(u=>t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:u.isPlaceholder?null:t.jsxs("div",{className:`flex items-center gap-2 ${u.column.getCanSort()?"cursor-pointer select-none":""}`,onClick:u.column.getToggleSortingHandler(),children:[re(u.column.columnDef.header,u.getContext()),u.column.getCanSort()&&t.jsxs("span",{className:"flex flex-col",children:[t.jsx(Xe,{className:`w-3 h-3 ${u.column.getIsSorted()==="asc"?"text-primary-600":"text-gray-400"}`}),t.jsx(Qe,{className:`w-3 h-3 -mt-1 ${u.column.getIsSorted()==="desc"?"text-primary-600":"text-gray-400"}`})]})]})},u.id))},c.id))}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:b.getRowModel().rows.map(c=>t.jsx("tr",{className:`hover:bg-gray-50 ${n?"cursor-pointer":""}`,onClick:()=>n==null?void 0:n(c.original),children:c.getVisibleCells().map(u=>t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:re(u.column.columnDef.cell,u.getContext())},u.id))},c.id))})]})}),r&&t.jsxs("div",{className:"card-footer flex items-center justify-between",children:[t.jsxs("div",{className:"text-sm text-gray-700",children:["Showing ",(r.page-1)*r.pageSize+1," to"," ",Math.min(r.page*r.pageSize,r.total)," of"," ",r.total," results"]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{className:"btn btn-secondary btn-sm",onClick:()=>r.onPageChange(r.page-1),disabled:r.page<=1,children:"Previous"}),t.jsxs("span",{className:"text-sm text-gray-700",children:["Page ",r.page," of ",Math.ceil(r.total/r.pageSize)]}),t.jsx("button",{className:"btn btn-secondary btn-sm",onClick:()=>r.onPageChange(r.page+1),disabled:r.page>=Math.ceil(r.total/r.pageSize),children:"Next"})]})]})]})}class lt{constructor(e="/api/events"){M(this,"skaldEventSource",null);M(this,"taskEventSource",null);M(this,"skaldCallbacks",new Map);M(this,"taskCallbacks",new Map);M(this,"connectionCallbacks",[]);M(this,"reconnectAttempts",0);M(this,"maxReconnectAttempts",5);M(this,"reconnectDelay",1e3);M(this,"connected",!1);M(this,"lastError",null);this.baseUrl=e}connect(){this.connectSkaldEvents(),this.connectTaskEvents()}disconnect(){this.disconnectSkaldEvents(),this.disconnectTaskEvents(),this.connected=!1,this.notifyConnectionState(!1)}reconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.error("Max reconnection attempts reached");return}this.reconnectAttempts++;const e=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);console.log(`Attempting to reconnect in ${e}ms (attempt ${this.reconnectAttempts})`),setTimeout(()=>{this.disconnect(),this.connect()},e)}connectSkaldEvents(){try{this.skaldEventSource=new EventSource(`${this.baseUrl}/skalds`),this.skaldEventSource.onopen=()=>{console.log("Skald SSE connection opened"),this.reconnectAttempts=0,this.connected=!0,this.lastError=null,this.notifyConnectionState(!0)},this.skaldEventSource.onmessage=e=>{try{const a=JSON.parse(e.data);this.handleSkaldEvent(a)}catch(a){console.error("Error parsing Skald event:",a)}},this.skaldEventSource.onerror=e=>{var a;console.error("Skald SSE error:",e),this.lastError=new Error("Skald SSE connection error"),this.connected=!1,this.notifyConnectionState(!1),((a=this.skaldEventSource)==null?void 0:a.readyState)===EventSource.CLOSED&&this.reconnect()}}catch(e){console.error("Failed to connect to Skald events:",e),this.lastError=e}}disconnectSkaldEvents(){this.skaldEventSource&&(this.skaldEventSource.close(),this.skaldEventSource=null)}connectTaskEvents(){try{this.taskEventSource=new EventSource(`${this.baseUrl}/tasks`),this.taskEventSource.onopen=()=>{console.log("Task SSE connection opened")},this.taskEventSource.onmessage=e=>{console.log("Received Task event:",e);try{const a=JSON.parse(e.data);this.handleTaskEvent(a)}catch(a){console.error("Error parsing Task event:",a)}},this.taskEventSource.onerror=e=>{var a;console.error("Task SSE error:",e),this.lastError=new Error("Task SSE connection error"),((a=this.taskEventSource)==null?void 0:a.readyState)===EventSource.CLOSED&&this.reconnect()}}catch(e){console.error("Failed to connect to Task events:",e),this.lastError=e}}disconnectTaskEvents(){this.taskEventSource&&(this.taskEventSource.close(),this.taskEventSource=null)}subscribeToSkald(e,a){return this.skaldCallbacks.has(e)||this.skaldCallbacks.set(e,[]),this.skaldCallbacks.get(e).push(a),()=>{const r=this.skaldCallbacks.get(e);if(r){const n=r.indexOf(a);n>-1&&r.splice(n,1),r.length===0&&this.skaldCallbacks.delete(e)}}}subscribeToTask(e,a){return this.taskCallbacks.has(e)||this.taskCallbacks.set(e,[]),this.taskCallbacks.get(e).push(a),()=>{const r=this.taskCallbacks.get(e);if(r){const n=r.indexOf(a);n>-1&&r.splice(n,1),r.length===0&&this.taskCallbacks.delete(e)}}}subscribeToConnection(e){return this.connectionCallbacks.push(e),()=>{const a=this.connectionCallbacks.indexOf(e);a>-1&&this.connectionCallbacks.splice(a,1)}}handleSkaldEvent(e){const a=this.skaldCallbacks.get(e.skaldId);a&&a.forEach(r=>{try{r(e)}catch(n){console.error("Error in Skald event callback:",n)}})}handleTaskEvent(e){const a=this.taskCallbacks.get(e.taskId);a&&a.forEach(r=>{try{r(e)}catch(n){console.error("Error in Task event callback:",n)}})}notifyConnectionState(e){this.connectionCallbacks.forEach(a=>{try{a(e)}catch(r){console.error("Error in connection state callback:",r)}})}isConnected(){return this.connected}getLastError(){return this.lastError}startMockEvents(){}startMockSkaldEvents(){const e=["skald-node-001","skald-node-002","skald-edge-001"];setInterval(()=>{const r={type:"skald_heartbeat",skaldId:e[Math.floor(Math.random()*e.length)],data:{heartbeat:Math.floor(Math.random()*100)}};this.handleSkaldEvent(r)},5e3)}startMockTaskEvents(){const e=["task-001","task-002","task-003","task-004","task-005"];setInterval(()=>{const r={type:"task_heartbeat",taskId:e[Math.floor(Math.random()*e.length)],data:{heartbeat:Math.floor(Math.random()*200)}};this.handleTaskEvent(r)},3e3)}}const ct="http://localhost:8000/api/events",C=new lt(ct),ye=o.createContext(void 0);function dt({children:s}){const[e,a]=o.useState(!1),[r,n]=o.useState(null),[i,m]=o.useState(new Map),[h,b]=o.useState(new Map),c=o.useCallback((d,p)=>{m(D=>{const w=new Map(D),j=w.get(d);return j?w.set(d,{...j,...p}):w.set(d,{id:d,type:"node",status:"offline",lastHeartbeat:new Date().toISOString(),supportedTasks:[],currentTasks:[],...p}),w})},[]),u=o.useCallback((d,p)=>{b(D=>{const w=new Map(D),j=w.get(d);return j?w.set(d,{...j,...p}):w.set(d,{id:d,className:"Unknown",lifecycleStatus:"Created",createDateTime:new Date().toISOString(),updateDateTime:new Date().toISOString(),attachments:{},heartbeat:0,...p}),w})},[]),v=o.useCallback(d=>{console.log("Received Skald event:",d);const p={};switch(d.type){case"skald_status":d.data.status&&(p.status=d.data.status),d.data.tasks&&(p.currentTasks=d.data.tasks);break;case"skald_heartbeat":d.data.heartbeat!==void 0&&(p.lastHeartbeat=new Date().toISOString(),p.status="online"),d.data.tasks&&(p.currentTasks=d.data.tasks);break}Object.keys(p).length>0&&c(d.skaldId,p)},[c]),T=o.useCallback(d=>{console.log("Received Task event:",d);const p={updateDateTime:new Date().toISOString()};switch(d.type){case"task_heartbeat":d.data.heartbeat!==void 0&&(p.heartbeat=d.data.heartbeat),d.data.lifecycleStatus!==void 0&&(p.lifecycleStatus=d.data.lifecycleStatus);break;case"task_error":d.data.error&&(p.error=d.data.error),d.data.lifecycleStatus!==void 0&&(p.lifecycleStatus=d.data.lifecycleStatus);break;case"task_exception":d.data.exception&&(p.exception=d.data.exception),d.data.lifecycleStatus!==void 0&&(p.lifecycleStatus=d.data.lifecycleStatus);break}u(d.taskId,p)},[u]),E=o.useCallback((d,p)=>C.subscribeToSkald(d,p),[]),S=o.useCallback((d,p)=>C.subscribeToTask(d,p),[]),g=o.useCallback(()=>{C.connect()},[]),x=o.useCallback(()=>{C.disconnect()},[]);o.useEffect(()=>{const d=C.subscribeToConnection(w=>{a(w),n(w?null:C.getLastError())}),p=C.handleSkaldEvent.bind(C),D=C.handleTaskEvent.bind(C);return C.handleSkaldEvent=w=>{p(w),v(w)},C.handleTaskEvent=w=>{D(w),T(w)},C.connect(),()=>{C.handleSkaldEvent=p,C.handleTaskEvent=D,d(),C.disconnect()}},[v,T]),o.useEffect(()=>{const d=setInterval(()=>{a(C.isConnected()),n(C.getLastError())},1e3);return()=>clearInterval(d)},[]);const k={isConnected:e,lastError:r,skalds:i,updateSkald:c,tasks:h,updateTask:u,subscribeToSkald:E,subscribeToTask:S,connect:g,disconnect:x};return t.jsx(ye.Provider,{value:k,children:s})}function we(){const s=o.useContext(ye);if(s===void 0)throw new Error("useSSE must be used within an SSEProvider");return s}function ut(){const{data:s,isLoading:e,error:a}=X({queryKey:["skalds"],queryFn:()=>Y.getSkalds(),retry:2,retryDelay:1e3}),{skalds:r,isConnected:n,lastError:i,updateSkald:m}=we(),h=o.useMemo(()=>s!=null&&s.items?s.items.map(c=>{const u=r.get(c.id);return u?{...c,...u,supportedTasks:c.supportedTasks,type:c.type}:c}):[],[s==null?void 0:s.items,r]);if(o.useEffect(()=>{if(!(s!=null&&s.items))return;const c=[];return s.items.forEach(u=>{r.has(u.id)||m(u.id,u)}),()=>{c.forEach(u=>u())}},[s==null?void 0:s.items,r,m]),o.useEffect(()=>{var c;console.log("SkaldsPage status:",{isLoading:e,error:a,skalds:((c=s==null?void 0:s.items)==null?void 0:c.length)||0,sseConnected:n,sseError:i,sseSkalds:r.size})},[e,a,s,n,i,r]),a)return console.error("Skalds API error:",a),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Skalds"}),t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Monitor and manage your Skald workers"})]}),t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:t.jsxs("div",{className:"flex",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(B,{className:"h-5 w-5 text-red-400"})}),t.jsxs("div",{className:"ml-3",children:[t.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Failed to Load Skalds"}),t.jsxs("div",{className:"mt-2 text-sm text-red-700",children:[t.jsx("p",{children:"Unable to fetch Skald data from the API."}),t.jsxs("p",{className:"mt-2 font-mono text-xs bg-red-100 p-2 rounded",children:["Error: ",a instanceof Error?a.message:"Unknown error"]})]}),t.jsx("div",{className:"mt-4",children:t.jsx("button",{onClick:()=>window.location.reload(),className:"btn btn-sm btn-primary",children:"Retry"})})]})]})})]});const b=[{key:"id",header:"Skald ID",sortable:!0},{key:"type",header:"Type",sortable:!0,render:c=>t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${c==="node"?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"}`,children:c})},{key:"status",header:"Status",sortable:!0,render:c=>t.jsx(H,{status:c,animated:!0})},{key:"supportedTasks",header:"Supported Tasks",sortable:!1,render:c=>t.jsxs("div",{className:"flex flex-wrap gap-1",children:[c.slice(0,3).map((u,v)=>t.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-gray-100 text-gray-800",children:u},v)),c.length>3&&t.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-gray-100 text-gray-800",children:["+",c.length-3," more"]})]})},{key:"currentTasks",header:"Current Tasks",sortable:!0,render:c=>t.jsx("span",{className:"text-sm text-gray-900",children:c.length})}];return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Skalds"}),t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Monitor and manage your Skald workers"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ge,{className:`h-5 w-5 ${n?"text-green-500":"text-red-500"}`}),t.jsx("span",{className:`text-sm font-medium ${n?"text-green-700":"text-red-700"}`,children:n?"Live Updates":"Disconnected"}),i&&t.jsx("span",{className:"text-xs text-red-500",title:i.message,children:"(Error)"})]})]}),t.jsx(be,{data:h,columns:b,loading:e})]})}function P(s){const e=Object.prototype.toString.call(s);return s instanceof Date||typeof s=="object"&&e==="[object Date]"?new s.constructor(+s):typeof s=="number"||e==="[object Number]"||typeof s=="string"||e==="[object String]"?new Date(s):new Date(NaN)}function R(s,e){return s instanceof Date?new s.constructor(e):new Date(e)}const ke=6048e5,mt=864e5;let ht={};function z(){return ht}function V(s,e){var h,b,c,u;const a=z(),r=(e==null?void 0:e.weekStartsOn)??((b=(h=e==null?void 0:e.locale)==null?void 0:h.options)==null?void 0:b.weekStartsOn)??a.weekStartsOn??((u=(c=a.locale)==null?void 0:c.options)==null?void 0:u.weekStartsOn)??0,n=P(s),i=n.getDay(),m=(i<r?7:0)+i-r;return n.setDate(n.getDate()-m),n.setHours(0,0,0,0),n}function G(s){return V(s,{weekStartsOn:1})}function je(s){const e=P(s),a=e.getFullYear(),r=R(s,0);r.setFullYear(a+1,0,4),r.setHours(0,0,0,0);const n=G(r),i=R(s,0);i.setFullYear(a,0,4),i.setHours(0,0,0,0);const m=G(i);return e.getTime()>=n.getTime()?a+1:e.getTime()>=m.getTime()?a:a-1}function oe(s){const e=P(s);return e.setHours(0,0,0,0),e}function le(s){const e=P(s),a=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return a.setUTCFullYear(e.getFullYear()),+s-+a}function ft(s,e){const a=oe(s),r=oe(e),n=+a-le(a),i=+r-le(r);return Math.round((n-i)/mt)}function xt(s){const e=je(s),a=R(s,0);return a.setFullYear(e,0,4),a.setHours(0,0,0,0),G(a)}function gt(s){return s instanceof Date||typeof s=="object"&&Object.prototype.toString.call(s)==="[object Date]"}function pt(s){if(!gt(s)&&typeof s!="number")return!1;const e=P(s);return!isNaN(Number(e))}function bt(s){const e=P(s),a=R(s,0);return a.setFullYear(e.getFullYear(),0,1),a.setHours(0,0,0,0),a}const yt={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},wt=(s,e,a)=>{let r;const n=yt[s];return typeof n=="string"?r=n:e===1?r=n.one:r=n.other.replace("{{count}}",e.toString()),a!=null&&a.addSuffix?a.comparison&&a.comparison>0?"in "+r:r+" ago":r};function te(s){return(e={})=>{const a=e.width?String(e.width):s.defaultWidth;return s.formats[a]||s.formats[s.defaultWidth]}}const kt={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},jt={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},vt={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Nt={date:te({formats:kt,defaultWidth:"full"}),time:te({formats:jt,defaultWidth:"full"}),dateTime:te({formats:vt,defaultWidth:"full"})},St={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Tt=(s,e,a,r)=>St[s];function q(s){return(e,a)=>{const r=a!=null&&a.context?String(a.context):"standalone";let n;if(r==="formatting"&&s.formattingValues){const m=s.defaultFormattingWidth||s.defaultWidth,h=a!=null&&a.width?String(a.width):m;n=s.formattingValues[h]||s.formattingValues[m]}else{const m=s.defaultWidth,h=a!=null&&a.width?String(a.width):s.defaultWidth;n=s.values[h]||s.values[m]}const i=s.argumentCallback?s.argumentCallback(e):e;return n[i]}}const Ct={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Et={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Mt={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Dt={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Ot={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Pt={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},At=(s,e)=>{const a=Number(s),r=a%100;if(r>20||r<10)switch(r%10){case 1:return a+"st";case 2:return a+"nd";case 3:return a+"rd"}return a+"th"},Ft={ordinalNumber:At,era:q({values:Ct,defaultWidth:"wide"}),quarter:q({values:Et,defaultWidth:"wide",argumentCallback:s=>s-1}),month:q({values:Mt,defaultWidth:"wide"}),day:q({values:Dt,defaultWidth:"wide"}),dayPeriod:q({values:Ot,defaultWidth:"wide",formattingValues:Pt,defaultFormattingWidth:"wide"})};function _(s){return(e,a={})=>{const r=a.width,n=r&&s.matchPatterns[r]||s.matchPatterns[s.defaultMatchWidth],i=e.match(n);if(!i)return null;const m=i[0],h=r&&s.parsePatterns[r]||s.parsePatterns[s.defaultParseWidth],b=Array.isArray(h)?Lt(h,v=>v.test(m)):Wt(h,v=>v.test(m));let c;c=s.valueCallback?s.valueCallback(b):b,c=a.valueCallback?a.valueCallback(c):c;const u=e.slice(m.length);return{value:c,rest:u}}}function Wt(s,e){for(const a in s)if(Object.prototype.hasOwnProperty.call(s,a)&&e(s[a]))return a}function Lt(s,e){for(let a=0;a<s.length;a++)if(e(s[a]))return a}function Rt(s){return(e,a={})=>{const r=e.match(s.matchPattern);if(!r)return null;const n=r[0],i=e.match(s.parsePattern);if(!i)return null;let m=s.valueCallback?s.valueCallback(i[0]):i[0];m=a.valueCallback?a.valueCallback(m):m;const h=e.slice(n.length);return{value:m,rest:h}}}const $t=/^(\d+)(th|st|nd|rd)?/i,It=/\d+/i,Ht={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Yt={any:[/^b/i,/^(a|c)/i]},qt={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},_t={any:[/1/i,/2/i,/3/i,/4/i]},Bt={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Vt={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Qt={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Ut={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Xt={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Gt={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},zt={ordinalNumber:Rt({matchPattern:$t,parsePattern:It,valueCallback:s=>parseInt(s,10)}),era:_({matchPatterns:Ht,defaultMatchWidth:"wide",parsePatterns:Yt,defaultParseWidth:"any"}),quarter:_({matchPatterns:qt,defaultMatchWidth:"wide",parsePatterns:_t,defaultParseWidth:"any",valueCallback:s=>s+1}),month:_({matchPatterns:Bt,defaultMatchWidth:"wide",parsePatterns:Vt,defaultParseWidth:"any"}),day:_({matchPatterns:Qt,defaultMatchWidth:"wide",parsePatterns:Ut,defaultParseWidth:"any"}),dayPeriod:_({matchPatterns:Xt,defaultMatchWidth:"any",parsePatterns:Gt,defaultParseWidth:"any"})},Jt={code:"en-US",formatDistance:wt,formatLong:Nt,formatRelative:Tt,localize:Ft,match:zt,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Kt(s){const e=P(s);return ft(e,bt(e))+1}function Zt(s){const e=P(s),a=+G(e)-+xt(e);return Math.round(a/ke)+1}function ve(s,e){var u,v,T,E;const a=P(s),r=a.getFullYear(),n=z(),i=(e==null?void 0:e.firstWeekContainsDate)??((v=(u=e==null?void 0:e.locale)==null?void 0:u.options)==null?void 0:v.firstWeekContainsDate)??n.firstWeekContainsDate??((E=(T=n.locale)==null?void 0:T.options)==null?void 0:E.firstWeekContainsDate)??1,m=R(s,0);m.setFullYear(r+1,0,i),m.setHours(0,0,0,0);const h=V(m,e),b=R(s,0);b.setFullYear(r,0,i),b.setHours(0,0,0,0);const c=V(b,e);return a.getTime()>=h.getTime()?r+1:a.getTime()>=c.getTime()?r:r-1}function es(s,e){var h,b,c,u;const a=z(),r=(e==null?void 0:e.firstWeekContainsDate)??((b=(h=e==null?void 0:e.locale)==null?void 0:h.options)==null?void 0:b.firstWeekContainsDate)??a.firstWeekContainsDate??((u=(c=a.locale)==null?void 0:c.options)==null?void 0:u.firstWeekContainsDate)??1,n=ve(s,e),i=R(s,0);return i.setFullYear(n,0,r),i.setHours(0,0,0,0),V(i,e)}function ts(s,e){const a=P(s),r=+V(a,e)-+es(a,e);return Math.round(r/ke)+1}function y(s,e){const a=s<0?"-":"",r=Math.abs(s).toString().padStart(e,"0");return a+r}const W={y(s,e){const a=s.getFullYear(),r=a>0?a:1-a;return y(e==="yy"?r%100:r,e.length)},M(s,e){const a=s.getMonth();return e==="M"?String(a+1):y(a+1,2)},d(s,e){return y(s.getDate(),e.length)},a(s,e){const a=s.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return a.toUpperCase();case"aaa":return a;case"aaaaa":return a[0];case"aaaa":default:return a==="am"?"a.m.":"p.m."}},h(s,e){return y(s.getHours()%12||12,e.length)},H(s,e){return y(s.getHours(),e.length)},m(s,e){return y(s.getMinutes(),e.length)},s(s,e){return y(s.getSeconds(),e.length)},S(s,e){const a=e.length,r=s.getMilliseconds(),n=Math.trunc(r*Math.pow(10,a-3));return y(n,e.length)}},I={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},ce={G:function(s,e,a){const r=s.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return a.era(r,{width:"abbreviated"});case"GGGGG":return a.era(r,{width:"narrow"});case"GGGG":default:return a.era(r,{width:"wide"})}},y:function(s,e,a){if(e==="yo"){const r=s.getFullYear(),n=r>0?r:1-r;return a.ordinalNumber(n,{unit:"year"})}return W.y(s,e)},Y:function(s,e,a,r){const n=ve(s,r),i=n>0?n:1-n;if(e==="YY"){const m=i%100;return y(m,2)}return e==="Yo"?a.ordinalNumber(i,{unit:"year"}):y(i,e.length)},R:function(s,e){const a=je(s);return y(a,e.length)},u:function(s,e){const a=s.getFullYear();return y(a,e.length)},Q:function(s,e,a){const r=Math.ceil((s.getMonth()+1)/3);switch(e){case"Q":return String(r);case"QQ":return y(r,2);case"Qo":return a.ordinalNumber(r,{unit:"quarter"});case"QQQ":return a.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return a.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return a.quarter(r,{width:"wide",context:"formatting"})}},q:function(s,e,a){const r=Math.ceil((s.getMonth()+1)/3);switch(e){case"q":return String(r);case"qq":return y(r,2);case"qo":return a.ordinalNumber(r,{unit:"quarter"});case"qqq":return a.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return a.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return a.quarter(r,{width:"wide",context:"standalone"})}},M:function(s,e,a){const r=s.getMonth();switch(e){case"M":case"MM":return W.M(s,e);case"Mo":return a.ordinalNumber(r+1,{unit:"month"});case"MMM":return a.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return a.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return a.month(r,{width:"wide",context:"formatting"})}},L:function(s,e,a){const r=s.getMonth();switch(e){case"L":return String(r+1);case"LL":return y(r+1,2);case"Lo":return a.ordinalNumber(r+1,{unit:"month"});case"LLL":return a.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return a.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return a.month(r,{width:"wide",context:"standalone"})}},w:function(s,e,a,r){const n=ts(s,r);return e==="wo"?a.ordinalNumber(n,{unit:"week"}):y(n,e.length)},I:function(s,e,a){const r=Zt(s);return e==="Io"?a.ordinalNumber(r,{unit:"week"}):y(r,e.length)},d:function(s,e,a){return e==="do"?a.ordinalNumber(s.getDate(),{unit:"date"}):W.d(s,e)},D:function(s,e,a){const r=Kt(s);return e==="Do"?a.ordinalNumber(r,{unit:"dayOfYear"}):y(r,e.length)},E:function(s,e,a){const r=s.getDay();switch(e){case"E":case"EE":case"EEE":return a.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return a.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return a.day(r,{width:"short",context:"formatting"});case"EEEE":default:return a.day(r,{width:"wide",context:"formatting"})}},e:function(s,e,a,r){const n=s.getDay(),i=(n-r.weekStartsOn+8)%7||7;switch(e){case"e":return String(i);case"ee":return y(i,2);case"eo":return a.ordinalNumber(i,{unit:"day"});case"eee":return a.day(n,{width:"abbreviated",context:"formatting"});case"eeeee":return a.day(n,{width:"narrow",context:"formatting"});case"eeeeee":return a.day(n,{width:"short",context:"formatting"});case"eeee":default:return a.day(n,{width:"wide",context:"formatting"})}},c:function(s,e,a,r){const n=s.getDay(),i=(n-r.weekStartsOn+8)%7||7;switch(e){case"c":return String(i);case"cc":return y(i,e.length);case"co":return a.ordinalNumber(i,{unit:"day"});case"ccc":return a.day(n,{width:"abbreviated",context:"standalone"});case"ccccc":return a.day(n,{width:"narrow",context:"standalone"});case"cccccc":return a.day(n,{width:"short",context:"standalone"});case"cccc":default:return a.day(n,{width:"wide",context:"standalone"})}},i:function(s,e,a){const r=s.getDay(),n=r===0?7:r;switch(e){case"i":return String(n);case"ii":return y(n,e.length);case"io":return a.ordinalNumber(n,{unit:"day"});case"iii":return a.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return a.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return a.day(r,{width:"short",context:"formatting"});case"iiii":default:return a.day(r,{width:"wide",context:"formatting"})}},a:function(s,e,a){const n=s.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return a.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"aaa":return a.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return a.dayPeriod(n,{width:"narrow",context:"formatting"});case"aaaa":default:return a.dayPeriod(n,{width:"wide",context:"formatting"})}},b:function(s,e,a){const r=s.getHours();let n;switch(r===12?n=I.noon:r===0?n=I.midnight:n=r/12>=1?"pm":"am",e){case"b":case"bb":return a.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"bbb":return a.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return a.dayPeriod(n,{width:"narrow",context:"formatting"});case"bbbb":default:return a.dayPeriod(n,{width:"wide",context:"formatting"})}},B:function(s,e,a){const r=s.getHours();let n;switch(r>=17?n=I.evening:r>=12?n=I.afternoon:r>=4?n=I.morning:n=I.night,e){case"B":case"BB":case"BBB":return a.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"BBBBB":return a.dayPeriod(n,{width:"narrow",context:"formatting"});case"BBBB":default:return a.dayPeriod(n,{width:"wide",context:"formatting"})}},h:function(s,e,a){if(e==="ho"){let r=s.getHours()%12;return r===0&&(r=12),a.ordinalNumber(r,{unit:"hour"})}return W.h(s,e)},H:function(s,e,a){return e==="Ho"?a.ordinalNumber(s.getHours(),{unit:"hour"}):W.H(s,e)},K:function(s,e,a){const r=s.getHours()%12;return e==="Ko"?a.ordinalNumber(r,{unit:"hour"}):y(r,e.length)},k:function(s,e,a){let r=s.getHours();return r===0&&(r=24),e==="ko"?a.ordinalNumber(r,{unit:"hour"}):y(r,e.length)},m:function(s,e,a){return e==="mo"?a.ordinalNumber(s.getMinutes(),{unit:"minute"}):W.m(s,e)},s:function(s,e,a){return e==="so"?a.ordinalNumber(s.getSeconds(),{unit:"second"}):W.s(s,e)},S:function(s,e){return W.S(s,e)},X:function(s,e,a){const r=s.getTimezoneOffset();if(r===0)return"Z";switch(e){case"X":return ue(r);case"XXXX":case"XX":return L(r);case"XXXXX":case"XXX":default:return L(r,":")}},x:function(s,e,a){const r=s.getTimezoneOffset();switch(e){case"x":return ue(r);case"xxxx":case"xx":return L(r);case"xxxxx":case"xxx":default:return L(r,":")}},O:function(s,e,a){const r=s.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+de(r,":");case"OOOO":default:return"GMT"+L(r,":")}},z:function(s,e,a){const r=s.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+de(r,":");case"zzzz":default:return"GMT"+L(r,":")}},t:function(s,e,a){const r=Math.trunc(s.getTime()/1e3);return y(r,e.length)},T:function(s,e,a){const r=s.getTime();return y(r,e.length)}};function de(s,e=""){const a=s>0?"-":"+",r=Math.abs(s),n=Math.trunc(r/60),i=r%60;return i===0?a+String(n):a+String(n)+e+y(i,2)}function ue(s,e){return s%60===0?(s>0?"-":"+")+y(Math.abs(s)/60,2):L(s,e)}function L(s,e=""){const a=s>0?"-":"+",r=Math.abs(s),n=y(Math.trunc(r/60),2),i=y(r%60,2);return a+n+e+i}const me=(s,e)=>{switch(s){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},Ne=(s,e)=>{switch(s){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},ss=(s,e)=>{const a=s.match(/(P+)(p+)?/)||[],r=a[1],n=a[2];if(!n)return me(s,e);let i;switch(r){case"P":i=e.dateTime({width:"short"});break;case"PP":i=e.dateTime({width:"medium"});break;case"PPP":i=e.dateTime({width:"long"});break;case"PPPP":default:i=e.dateTime({width:"full"});break}return i.replace("{{date}}",me(r,e)).replace("{{time}}",Ne(n,e))},as={p:Ne,P:ss},rs=/^D+$/,ns=/^Y+$/,is=["D","DD","YY","YYYY"];function os(s){return rs.test(s)}function ls(s){return ns.test(s)}function cs(s,e,a){const r=ds(s,e,a);if(console.warn(r),is.includes(s))throw new RangeError(r)}function ds(s,e,a){const r=s[0]==="Y"?"years":"days of the month";return`Use \`${s.toLowerCase()}\` instead of \`${s}\` (in \`${e}\`) for formatting ${r} to the input \`${a}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const us=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,ms=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,hs=/^'([^]*?)'?$/,fs=/''/g,xs=/[a-zA-Z]/;function he(s,e,a){var u,v,T,E;const r=z(),n=r.locale??Jt,i=r.firstWeekContainsDate??((v=(u=r.locale)==null?void 0:u.options)==null?void 0:v.firstWeekContainsDate)??1,m=r.weekStartsOn??((E=(T=r.locale)==null?void 0:T.options)==null?void 0:E.weekStartsOn)??0,h=P(s);if(!pt(h))throw new RangeError("Invalid time value");let b=e.match(ms).map(S=>{const g=S[0];if(g==="p"||g==="P"){const x=as[g];return x(S,n.formatLong)}return S}).join("").match(us).map(S=>{if(S==="''")return{isToken:!1,value:"'"};const g=S[0];if(g==="'")return{isToken:!1,value:gs(S)};if(ce[g])return{isToken:!0,value:S};if(g.match(xs))throw new RangeError("Format string contains an unescaped latin alphabet character `"+g+"`");return{isToken:!1,value:S}});n.localize.preprocessor&&(b=n.localize.preprocessor(h,b));const c={firstWeekContainsDate:i,weekStartsOn:m,locale:n};return b.map(S=>{if(!S.isToken)return S.value;const g=S.value;(ls(g)||os(g))&&cs(g,e,String(s));const x=ce[g[0]];return x(h,g,n.localize,c)}).join("")}function gs(s){const e=s.match(hs);return e?e[1].replace(fs,"'"):s}function ps({task:s,onClose:e,onUpdated:a}){const[r,n]=o.useState({...s.attachments}),[i,m]=o.useState(s.lifecycleStatus),[h,b]=o.useState(!1),[c,u]=o.useState(null),[v,T]=o.useState(null);function E({value:x,onChange:k,path:d=[]}){const p=()=>{Array.isArray(x)?k([...x,""]):typeof x=="object"&&x!==null&&k({...x,"":""})},D=j=>{if(Array.isArray(x))k(x.filter((N,O)=>O!==j));else if(typeof x=="object"&&x!==null){const{[j]:N,...O}=x;k(O)}},w=(j,N)=>{if(typeof x=="object"&&x!==null&&!Array.isArray(x)){const{[j]:O,...A}=x;k({...A,[N]:O})}};return Array.isArray(x)?t.jsxs("div",{className:"ml-4 border-l-2 border-gray-200 pl-2 space-y-2",children:[x.map((j,N)=>t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(E,{value:j,onChange:O=>k(x.map((A,Q)=>Q===N?O:A)),path:[...d,N]}),t.jsx("button",{className:"text-xs text-red-500 hover:text-red-700 px-1",onClick:()=>D(N),title:"Remove",type:"button",children:"×"})]},N)),t.jsx("button",{className:"text-xs text-blue-600 hover:underline mt-1",onClick:p,type:"button",children:"+ Add Item"})]}):typeof x=="object"&&x!==null?t.jsxs("div",{className:"ml-4 border-l-2 border-gray-200 pl-2 space-y-2",children:[Object.entries(x).map(([j,N],O)=>t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx("input",{type:"text",className:"w-1/4 rounded border px-2 py-1 text-xs",value:j,onChange:A=>w(j,A.target.value),placeholder:"Key"}),t.jsx(E,{value:N,onChange:A=>k({...x,[j]:A}),path:[...d,j]}),t.jsx("button",{className:"text-xs text-red-500 hover:text-red-700 px-1",onClick:()=>D(j),title:"Remove",type:"button",children:"×"})]},j+O)),t.jsx("button",{className:"text-xs text-blue-600 hover:underline mt-1",onClick:p,type:"button",children:"+ Add Field"})]}):t.jsx("input",{type:"text",className:"w-2/3 rounded border px-2 py-1 text-xs",value:x==null?"":String(x),onChange:j=>{let N=j.target.value;N==="true"?N=!0:N==="false"?N=!1:!isNaN(Number(N))&&N.trim()!==""&&(N=Number(N)),k(N)},placeholder:"Value"})}const S=async()=>{b(!0),u(null),T(null);try{const x=await Y.updateTaskAttachments(s.id,{attachments:r});T("Attachments updated successfully"),a&&a(x)}catch(x){u(x.message||"Failed to update attachments")}finally{b(!1)}},g=async x=>{b(!0),u(null),T(null);try{const k=await Y.updateTaskStatus(s.id,{lifecycleStatus:x}),d={...s,id:k.data.taskId,lifecycleStatus:k.data.status,updateDateTime:new Date().toISOString()};m(k.data.status),T(k.message||`Status changed to ${k.data.status}`),a&&a(d)}catch(k){u(k.message||"Failed to update status")}finally{b(!1)}};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40",children:t.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-0 w-full max-w-2xl relative flex flex-col",style:{maxHeight:"90vh"},children:[t.jsx("button",{className:"absolute top-3 right-3 text-gray-400 hover:text-gray-700 text-2xl",onClick:e,style:{lineHeight:1},children:"×"}),t.jsxs("div",{className:"px-8 pt-7 pb-2 border-b border-gray-100",children:[t.jsx("h2",{className:"text-2xl font-bold mb-1 text-gray-900",children:"Task Details"}),t.jsxs("div",{className:"flex flex-wrap gap-x-8 gap-y-1 text-xs text-gray-500 mb-1",children:[t.jsxs("div",{children:["Task ID: ",t.jsx("span",{className:"font-mono",children:s.id})]}),t.jsxs("div",{children:["Type: ",s.className]}),t.jsxs("div",{children:["Executor: ",s.executor||"Unassigned"]}),t.jsxs("div",{children:["Status: ",t.jsx("span",{className:"font-mono",children:i})]})]})]}),t.jsxs("div",{className:"overflow-y-auto px-8 py-4 flex-1",style:{minHeight:200},children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("h3",{className:"font-semibold text-sm mb-2",children:"Attachments"}),t.jsx(E,{value:r,onChange:n}),t.jsx("button",{className:"mt-3 px-4 py-1.5 rounded bg-primary-500 text-white text-sm font-medium shadow hover:bg-primary-600 transition",onClick:S,disabled:h,type:"button",children:h?"Updating...":"Update Attachments"})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("h3",{className:"font-semibold text-sm mb-2",children:"Change Status"}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsxs("button",{className:`flex items-center gap-2 px-5 py-2 rounded-lg text-base font-semibold shadow transition
                  ${i==="Cancelled"?"bg-yellow-200 text-yellow-600 cursor-not-allowed opacity-60":"bg-yellow-400 text-white hover:bg-yellow-500 scale-105 border-2 border-yellow-500"}
                `,onClick:()=>g("Cancelled"),disabled:h||i==="Cancelled",type:"button",title:i==="Cancelled"?"Already Cancelled":"Set status to Cancelled",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),"Set Cancelled"]}),t.jsxs("button",{className:`flex items-center gap-2 px-5 py-2 rounded-lg text-base font-semibold shadow transition
                  ${i==="Created"?"bg-green-200 text-green-600 cursor-not-allowed opacity-60":"bg-green-500 text-white hover:bg-green-600 scale-105 border-2 border-green-600"}
                `,onClick:()=>g("Created"),disabled:h||i==="Created",type:"button",title:i==="Created"?"Already Created":"Set status to Created",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Set Created"]})]})]}),c&&t.jsx("div",{className:"text-xs text-red-600 mb-2",children:c}),v&&t.jsx("div",{className:"text-xs text-green-600 mb-2",children:v})]}),t.jsx("div",{className:"px-8 pb-6 pt-2 border-t border-gray-100 flex justify-end",children:t.jsx("button",{className:"px-4 py-1.5 rounded bg-gray-200 text-gray-700 text-sm font-medium shadow hover:bg-gray-300 transition",onClick:e,type:"button",children:"Close"})})]})})}function bs(){const s=Me(),[e,a]=o.useState(1),[r,n]=o.useState(),[i,m]=o.useState(),[h,b]=o.useState(""),[c,u]=o.useState(""),[v,T]=o.useState({}),E=10;o.useEffect(()=>{const l=setTimeout(()=>{u(h)},400);return()=>clearTimeout(l)},[h]);const{data:S=[]}=X({queryKey:["task-classnames"],queryFn:()=>Y.getTaskClassNames(),staleTime:5*60*1e3}),{data:g,isLoading:x,error:k}=X({queryKey:["tasks",e,r,i,c],queryFn:async()=>Y.getTasks({page:e,pageSize:E,lifecycleStatus:r,className:i,id:c.trim()||void 0}),retry:2,retryDelay:1e3}),{tasks:d,isConnected:p,lastError:D,updateTask:w,subscribeToTask:j}=we(),N=o.useMemo(()=>Array.from(d.entries()).map(([l,f])=>`${l}:${f.heartbeat}:${f.lifecycleStatus}:${f.updateDateTime}`).join("|"),[d]),O=o.useMemo(()=>g!=null&&g.items?g.items.map(l=>{const f=v[l.id];if(f)return{...l,...f};const F=d.get(l.id);return F?{...l,...F,className:l.className,createDateTime:l.createDateTime}:l}):[],[g==null?void 0:g.items,N,v]);if(o.useEffect(()=>{if(!(g!=null&&g.items))return;const l=[];return g.items.forEach(f=>{d.has(f.id)||w(f.id,f)}),()=>{l.forEach(f=>f())}},[g==null?void 0:g.items,d,w,j]),k)return console.error("Tasks API error:",k),t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Tasks"}),t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Monitor and manage task execution"})]})}),t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:t.jsxs("div",{className:"flex",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(B,{className:"h-5 w-5 text-red-400"})}),t.jsxs("div",{className:"ml-3",children:[t.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Failed to Load Tasks"}),t.jsxs("div",{className:"mt-2 text-sm text-red-700",children:[t.jsx("p",{children:"Unable to fetch task data from the API."}),t.jsxs("p",{className:"mt-2 font-mono text-xs bg-red-100 p-2 rounded",children:["Error: ",k instanceof Error?k.message:"Unknown error"]})]}),t.jsx("div",{className:"mt-4",children:t.jsx("button",{onClick:()=>window.location.reload(),className:"btn btn-sm btn-primary",children:"Retry"})})]})]})})]});const A=[{key:"id",header:"Task ID",sortable:!0,render:l=>t.jsx("span",{className:"font-mono text-sm",children:l})},{key:"className",header:"Type",sortable:!0,render:l=>t.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:l})},{key:"mode",header:"Mode",sortable:!0,render:l=>t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${l==="Active"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:l})},{key:"lifecycleStatus",header:"Status",sortable:!0,render:l=>t.jsx(H,{status:l,animated:!0})},{key:"executor",header:"Executor",sortable:!0,render:l=>t.jsx("span",{className:"text-sm text-gray-900",children:l||"Unassigned"})},{key:"heartbeat",header:"Heartbeat",sortable:!0,render:(l,f)=>{const F=d.get(f.id);let K=(F==null?void 0:F.heartbeat)??l??0;return f.lifecycleStatus==="Finished"&&(K=200),t.jsx("span",{className:`text-sm font-mono ${K>0?"text-green-600":"text-gray-400"}`,children:K})}},{key:"createDateTime",header:"Created",sortable:!0,render:l=>{try{const f=new Date(l);return isNaN(f.getTime())?t.jsx("span",{className:"text-sm text-gray-400",children:"Invalid date"}):t.jsx("span",{className:"text-sm text-gray-500",children:he(f,"MMM dd, HH:mm")})}catch(f){return console.warn("Invalid date value:",l,f),t.jsx("span",{className:"text-sm text-gray-400",children:"Invalid date"})}}},{key:"updateDateTime",header:"Updated",sortable:!0,render:l=>{try{const f=new Date(l);return isNaN(f.getTime())?t.jsx("span",{className:"text-sm text-gray-400",children:"Invalid date"}):t.jsx("span",{className:"text-sm text-gray-500",children:he(f,"MMM dd, HH:mm")})}catch(f){return console.warn("Invalid date value:",l,f),t.jsx("span",{className:"text-sm text-gray-400",children:"Invalid date"})}}}],[Q,J]=o.useState(null);function Se(l){return l&&typeof l=="object"&&typeof l.id=="string"&&typeof l.className=="string"}const Te=[void 0,"Created","Assigning","Running","Paused","Finished","Failed","Cancelled"];return A.push({key:"actions",header:"Actions",sortable:!1,render:(l,f)=>Se(f)?t.jsxs("button",{className:"inline-flex items-center px-3 py-1 rounded bg-primary-500 text-white text-xs font-medium shadow hover:bg-primary-600 transition",style:{minWidth:70,minHeight:28},onClick:()=>{console.log("Details button clicked, row:",f),J(f)},children:[t.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12H9m12 0A9 9 0 11 3 12a9 9 0 0118 0z"})}),"Details"]}):t.jsx("span",{className:"text-xs text-gray-400",children:"N/A"})}),t.jsxs("div",{className:"space-y-6 w-full",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Tasks"}),t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Monitor and manage task execution"})]}),t.jsxs("div",{className:"flex items-center space-x-4 flex-nowrap",children:[t.jsxs("div",{className:"flex items-center space-x-2 flex-shrink-0 min-w-max",children:[t.jsx(ge,{className:`h-5 w-5 ${p?"text-green-500":"text-red-500"}`}),t.jsx("span",{className:`text-sm font-medium ${p?"text-green-700":"text-red-700"}`,children:p?"Live Updates":"Disconnected"}),D&&t.jsx("span",{className:"text-xs text-red-500",title:D.message,children:"(Error)"})]}),t.jsxs("div",{className:"flex flex-1 items-center space-x-2",children:[t.jsx("input",{type:"text",value:h,onChange:l=>b(l.target.value),placeholder:"Filter by Task ID",className:"block rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm px-3 py-2 w-full",style:{paddingLeft:"0.75rem",paddingRight:"0.75rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"}}),t.jsxs("select",{value:i||"",onChange:l=>m(l.target.value||void 0),className:"block rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm w-full",children:[t.jsx("option",{value:"",children:"All Types"}),S.map(l=>t.jsx("option",{value:l,children:l},l))]}),t.jsx("select",{value:r||"",onChange:l=>n(l.target.value||void 0),className:"block rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm w-full",children:Te.map(l=>t.jsx("option",{value:l||"",children:l||"All Status"},l||"all"))})]})]})]}),t.jsx(be,{data:O,columns:A,loading:x,pagination:{page:e,pageSize:E,total:(g==null?void 0:g.total)||0,onPageChange:a}}),Q&&t.jsx(ps,{task:Q,onClose:()=>J(null),onUpdated:l=>{console.log(l),console.log("Task updated id:",l.id),l&&l.id&&(T(f=>({...f,[l.id]:{...f[l.id],...l,lifecycleStatus:l.lifecycleStatus,updateDateTime:l.updateDateTime}})),s.setQueryData(["tasks",e,r,i,c],f=>f!=null&&f.items?{...f,items:f.items.map(F=>F.id===l.id?{...F,...l}:F)}:f),w(l.id,l)),J(null)}})]})}function ys(){return t.jsx(dt,{children:t.jsx(at,{children:t.jsxs(Le,{children:[t.jsx(Z,{path:"/",element:t.jsx(ot,{})}),t.jsx(Z,{path:"/skalds",element:t.jsx(ut,{})}),t.jsx(Z,{path:"/tasks",element:t.jsx(bs,{})})]})})})}class ws extends o.Component{constructor(){super(...arguments);M(this,"state",{hasError:!1})}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,r){console.error("ErrorBoundary caught an error:",a,r)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:t.jsx("div",{className:"max-w-md w-full bg-white shadow-lg rounded-lg p-6",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(B,{className:"h-8 w-8 text-red-400"})}),t.jsxs("div",{className:"ml-3",children:[t.jsx("h3",{className:"text-lg font-medium text-red-800",children:"Something went wrong"}),t.jsxs("div",{className:"mt-2 text-sm text-red-700",children:[t.jsx("p",{children:"An unexpected error occurred while rendering this page."}),this.state.error&&t.jsx("p",{className:"mt-2 font-mono text-xs bg-red-100 p-2 rounded",children:this.state.error.message})]}),t.jsx("div",{className:"mt-4",children:t.jsx("button",{onClick:()=>window.location.reload(),className:"btn btn-sm btn-primary",children:"Reload Page"})})]})]})})}):this.props.children}}const ks=new De({defaultOptions:{queries:{staleTime:1e3*60*5,retry:1}}});se.createRoot(document.getElementById("root")).render(t.jsx(Ae.StrictMode,{children:t.jsx(ws,{children:t.jsx(Oe,{client:ks,children:t.jsx(Re,{basename:"/dashboard",children:t.jsx(ys,{})})})})}));
//# sourceMappingURL=index-B-IAA92O.js.map
